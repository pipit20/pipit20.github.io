<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WOM Finance - Dompet Kredit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-base: #f8fafc;
      --bg-gradient-start: #f0fdfa;
      --bg-gradient-mid: #ecfeff;
      --bg-gradient-end: #fefce8;
      --card-bg: rgba(255, 255, 255, 0.85);
      --card-border: rgba(148, 163, 184, 0.15);
      --accent-primary: #0d9488;
      --accent-primary-dark: #0f766e;
      --accent-gold: #d97706;
      --accent-gold-light: #fbbf24;
      --accent-coral: #f43f5e;
      --accent-emerald: #10b981;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --shadow-card: 0 10px 40px -10px rgba(0, 0, 0, 0.08);
      --shadow-card-hover: 0 20px 50px -15px rgba(0, 0, 0, 0.12);
    }

    * { box-sizing: border-box; }
    
    body { 
      font-family: 'Plus Jakarta Sans', sans-serif; 
      background: var(--bg-base);
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    .font-display { font-family: 'Space Grotesk', sans-serif; }

    /* Animated Mesh Background */
    .bg-mesh {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .mesh-blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.6;
      animation: drift 25s ease-in-out infinite alternate;
    }

    .blob-1 {
      width: 500px;
      height: 500px;
      background: linear-gradient(135deg, #99f6e4 0%, #5eead4 100%);
      top: -150px;
      left: -100px;
      animation-delay: 0s;
    }

    .blob-2 {
      width: 400px;
      height: 400px;
      background: linear-gradient(135deg, #fef08a 0%, #fde047 100%);
      bottom: -100px;
      right: -50px;
      animation-delay: -8s;
    }

    .blob-3 {
      width: 350px;
      height: 350px;
      background: linear-gradient(135deg, #a5f3fc 0%, #67e8f9 100%);
      top: 40%;
      left: 60%;
      animation-delay: -15s;
    }

    .blob-4 {
      width: 300px;
      height: 300px;
      background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
      top: 20%;
      right: 20%;
      animation-delay: -20s;
      opacity: 0.4;
    }

    @keyframes drift {
      0% { transform: translate(0, 0) rotate(0deg) scale(1); }
      50% { transform: translate(30px, 20px) rotate(5deg) scale(1.05); }
      100% { transform: translate(-20px, -10px) rotate(-5deg) scale(0.95); }
    }

    /* Cards */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--card-border);
      border-radius: 1.25rem;
      box-shadow: var(--shadow-card);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-gold));
      opacity: 0;
      transition: opacity 0.3s;
    }

    .card:hover::before { opacity: 1; }

    .card:hover {
      box-shadow: var(--shadow-card-hover);
      transform: translateY(-4px);
      border-color: rgba(13, 148, 136, 0.2);
    }

    /* Form Inputs */
    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      background: #ffffff;
      color: var(--text-primary);
      font-size: 0.9rem;
      transition: all 0.25s;
    }

    .form-input:focus {
      border-color: var(--accent-primary);
      background: #ffffff;
      box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.1);
      outline: none;
    }

    .form-input::placeholder { color: var(--text-muted); }

    .form-input option {
      background: #ffffff;
      color: var(--text-primary);
    }

    /* Navigation Tabs */
    .nav-container {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 0.375rem;
      box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.05);
    }

    .nav-tab {
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      font-size: 0.875rem;
      border-radius: 0.75rem;
      transition: all 0.3s;
      color: var(--text-secondary);
      border: none;
      background: transparent;
      cursor: pointer;
      position: relative;
    }

    .nav-tab:hover { 
      color: var(--accent-primary); 
      background: rgba(13, 148, 136, 0.05);
    }

    .nav-tab.active {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-primary-dark));
      color: white;
      box-shadow: 0 4px 15px -3px rgba(13, 148, 136, 0.4);
    }

    /* Primary Button */
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-gold-light) 100%);
      color: #ffffff;
      font-weight: 700;
      padding: 1rem 2.5rem;
      border-radius: 0.875rem;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px -3px rgba(217, 119, 6, 0.5);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px -5px rgba(217, 119, 6, 0.6);
    }

    .btn-primary:active { transform: translateY(-1px); }

    /* Product Items */
    .prod-item {
      padding: 1.25rem 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      background: #ffffff;
      text-align: center;
      position: relative;
    }

    .prod-item:hover {
      border-color: var(--accent-primary);
      background: rgba(13, 148, 136, 0.02);
    }

    .prod-item.active {
      border-color: var(--accent-primary);
      background: linear-gradient(135deg, rgba(13, 148, 136, 0.08), rgba(13, 148, 136, 0.02));
      box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.1);
    }

    .prod-item.active .prod-title { color: var(--accent-primary); }

    /* Section Title */
    .section-title {
      font-weight: 700;
      font-size: 0.75rem;
      color: var(--accent-primary);
      border-left: 3px solid var(--accent-primary);
      padding-left: 0.875rem;
      margin-bottom: 1.25rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .section-title.gold { border-color: var(--accent-gold); color: var(--accent-gold); }
    .section-title.coral { border-color: var(--accent-coral); color: var(--accent-coral); }
    .section-title.emerald { border-color: var(--accent-emerald); color: var(--accent-emerald); }

    /* Page Animation */
    .page-section { display: none; animation: fadeSlideIn 0.5s ease; }
    .page-section.active { display: block; }

    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Rupiah Input */
    .rp-wrap { position: relative; }
    .rp-pre {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--accent-gold);
      font-weight: 700;
      font-size: 0.875rem;
      pointer-events: none;
    }
    .rp-inp { padding-left: 2.75rem !important; }

    /* Result Cards */
    .result-group {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.12);
      border-radius: 1rem;
      margin-bottom: 0.875rem;
      overflow: hidden;
      transition: all 0.3s;
    }

    .result-group:hover {
      border-color: rgba(13, 148, 136, 0.2);
      box-shadow: 0 4px 15px -5px rgba(0, 0, 0, 0.05);
    }

    .result-header {
      padding: 0.75rem 1.25rem;
      font-weight: 700;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .result-header.valid {
      background: linear-gradient(90deg, rgba(16, 185, 129, 0.1), transparent);
      color: var(--accent-emerald);
    }

    .result-header.invalid {
      background: linear-gradient(90deg, rgba(244, 63, 94, 0.1), transparent);
      color: var(--accent-coral);
    }

    .result-header.warn {
      background: linear-gradient(90deg, rgba(217, 119, 6, 0.1), transparent);
      color: var(--accent-gold);
    }

    .result-body { padding: 1rem 1.25rem; }

    .result-row {
      display: flex;
      align-items: flex-start;
      gap: 0.625rem;
      padding: 0.5rem 0;
      font-size: 0.85rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.06);
    }

    .result-row:last-child { border-bottom: none; }

    .res-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 0.65rem;
      font-weight: 800;
      margin-top: 1px;
    }

    .res-icon.pass { background: rgba(16, 185, 129, 0.15); color: var(--accent-emerald); }
    .res-icon.fail { background: rgba(244, 63, 94, 0.15); color: var(--accent-coral); }
    .res-icon.warn { background: rgba(217, 119, 6, 0.15); color: var(--accent-gold); }

    .res-text { flex: 1; color: var(--text-secondary); }

    /* Status Badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 9999px;
      font-size: 0.9rem;
      font-weight: 700;
      margin-bottom: 1.25rem;
    }

    .status-pass {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
      color: var(--accent-emerald);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .status-fail {
      background: linear-gradient(135deg, rgba(244, 63, 94, 0.15), rgba(244, 63, 94, 0.05));
      color: var(--accent-coral);
      border: 1px solid rgba(244, 63, 94, 0.2);
    }

    .status-warn {
      background: linear-gradient(135deg, rgba(217, 119, 6, 0.15), rgba(217, 119, 6, 0.05));
      color: var(--accent-gold);
      border: 1px solid rgba(217, 119, 6, 0.2);
    }

    .hidden { display: none !important; }

    /* Custom Checkbox */
    .custom-check {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      cursor: pointer;
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      padding: 0.875rem;
      border: 2px solid #e2e8f0;
      border-radius: 0.875rem;
      transition: all 0.2s;
      background: rgba(255, 255, 255, 0.8);
    }

    .custom-check:hover {
      border-color: var(--accent-primary);
      background: rgba(13, 148, 136, 0.02);
    }

    .custom-check input {
      width: 1.25rem;
      height: 1.25rem;
      accent-color: var(--accent-primary);
      cursor: pointer;
      margin-top: 0.1rem;
      flex-shrink: 0;
    }

    /* Deviasi Category Box */
    .dev-cat-box {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.12);
      border-radius: 1rem;
      margin-bottom: 1.25rem;
      overflow: hidden;
      transition: all 0.3s;
    }

    .dev-cat-box:hover { 
      border-color: rgba(13, 148, 136, 0.2);
      box-shadow: 0 4px 15px -5px rgba(0, 0, 0, 0.05);
    }

    .dev-cat-header {
      background: linear-gradient(90deg, rgba(13, 148, 136, 0.08), rgba(255, 255, 255, 0.5));
      padding: 1rem 1.5rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    .dev-cat-title {
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.625rem;
    }

    .dev-cat-badge {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-primary-dark));
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .dev-cat-body { padding: 1.25rem 1.5rem; }

    .dev-note {
      background: rgba(13, 148, 136, 0.08);
      color: var(--accent-primary);
      padding: 0.25rem 0.625rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      margin-top: 0.25rem;
      display: inline-block;
      border: 1px solid rgba(13, 148, 136, 0.1);
    }

    /* Super Tab */
    .super-tab {
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      font-size: 0.85rem;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .super-tab.active {
      background: linear-gradient(135deg, rgba(13, 148, 136, 0.1), rgba(13, 148, 136, 0.02));
      color: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .super-tab:not(.active) {
      background: transparent;
      color: var(--text-muted);
    }

    .super-tab:not(.active):hover {
      background: rgba(13, 148, 136, 0.05);
      color: var(--text-secondary);
    }

    /* Deviasi Approval Badge */
    .dev-approval-badge {
      padding: 0.375rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .app-cac { background: rgba(16, 185, 129, 0.15); color: #059669; }
    .app-cam { background: rgba(13, 148, 136, 0.15); color: var(--accent-primary); }
    .app-cdh { background: rgba(139, 92, 246, 0.15); color: #7c3aed; }
    .app-cddh { background: rgba(236, 72, 153, 0.15); color: #db2777; }
    .app-cadh { background: rgba(217, 119, 6, 0.15); color: var(--accent-gold); }
    .app-cro { background: rgba(244, 63, 94, 0.15); color: var(--accent-coral); }
    .app-reject { background: rgba(239, 68, 68, 0.15); color: #dc2626; }

    /* Final Approval Box */
    .final-approval-box {
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-primary-dark) 100%);
      color: white;
      padding: 1.75rem;
      border-radius: 1rem;
      text-align: center;
      margin-top: 1.25rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 30px -5px rgba(13, 148, 136, 0.4);
    }

    .final-approval-box::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
      pointer-events: none;
    }

    .final-approval-level {
      font-size: 2.25rem;
      font-weight: 800;
      font-family: 'Space Grotesk', sans-serif;
      letter-spacing: -0.02em;
    }

    .final-approval-note {
      font-size: 0.8rem;
      opacity: 0.85;
      margin-top: 0.375rem;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 1.5rem;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 64px;
      height: 64px;
      margin: 0 auto 1rem;
      opacity: 0.4;
      color: var(--accent-primary);
    }

    /* Labels */
    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    /* Logo styling */
    .logo-img {
      height: 4rem;
      width: auto;
      object-fit: contain;
      transition: all 0.3s;
    }

    .logo-img:hover { transform: scale(1.05); }

    /* Header */
    .main-header {
      background: rgba(131, 214, 194, 0.936);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }

    /* Info Box */
    .info-box {
      background: linear-gradient(135deg, rgba(13, 148, 136, 0.05), rgba(217, 119, 6, 0.03));
      border: 1px solid rgba(13, 148, 136, 0.15);
      border-radius: 1rem;
      padding: 1.5rem;
    }

    /* Result Container */
    .result-container {
      border: 1px solid rgba(13, 148, 136, 0.2);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    /* Responsive */
    @media (max-width: 768px) {
      .mesh-blob { opacity: 0.4; }
      .final-approval-level { font-size: 1.75rem; }
      .nav-tab { padding: 0.625rem 1rem; font-size: 0.8rem; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .mesh-blob, .page-section { animation: none; }
      * { transition-duration: 0.01ms !important; }
    }
  </style>
</head>
<body>
  <!-- Animated Background -->
  <div class="bg-mesh">
    <div class="mesh-blob blob-1"></div>
    <div class="mesh-blob blob-2"></div>
    <div class="mesh-blob blob-3"></div>
    <div class="mesh-blob blob-4"></div>
  </div>

  <!-- Header -->
  <header class="main-header sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
      <div class="flex items-center flex-wrap justify-center md:justify-start gap-3 sm:gap-4">
        <img src="womfinance.png" alt="WOM Finance" class="logo-img">
        <div class="text-center sm:text-left">
          <h1 class="font-display font-bold text-xl text-white">Dompet Kredit</h1>
          <p class="text-xs text-white">Credit Eligibility Checker</p>
        </div>
        <img src="womjatim.png" alt="WOM Jatim" class="logo-img">
        <img src="cream.png" alt="Cream" class="logo-img">
      </div>
      <nav class="nav-container">
        <button onclick="navigatePage('norkil')" id="btn-norkil" class="nav-tab active">Normal Kilat</button>
        <button onclick="navigatePage('deviasi')" id="btn-deviasi" class="nav-tab">Deviasi</button>
        <button onclick="navigatePage('super')" id="btn-super" class="nav-tab">MobilKu Super</button>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 py-8">

    <!-- NORMAL KILAT PAGE -->
    <section id="page-norkil" class="page-section active">
      <div class="grid grid-cols-12 gap-6">
        <div class="col-span-12 lg:col-span-8 space-y-6">
          
          <!-- Product Selection -->
          <div class="card p-6">
            <h3 class="section-title">Pilih Produk Pembiayaan</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div id="prod-mobilku" onclick="selectProduct('mobilku')" class="prod-item active">
                <div class="prod-title font-display font-bold text-lg text-[var(--accent-primary)]">MobilKu</div>
              </div>
              <div id="prod-motorku" onclick="selectProduct('motorku')" class="prod-item">
                <div class="prod-title font-display font-bold text-lg text-[#0891b2]">MotorKu</div>
              </div>
              <div id="prod-newbike_bpjs" onclick="selectProduct('newbike_bpjs')" class="prod-item">
                <div class="prod-title font-display font-bold text-lg text-[var(--accent-emerald)]">NewBike BPJS</div>
              </div>
              <div id="prod-newbike_nonbpjs" onclick="selectProduct('newbike_nonbpjs')" class="prod-item">
                <div class="prod-title font-display font-bold text-lg text-[var(--accent-coral)]">NewBike Non-BPJS</div>
              </div>
            </div>
          </div>

          <!-- Form Card -->
          <div class="card p-6">
            <div class="space-y-6">
              
              <!-- Data Konsumen -->
              <div>
                <h3 class="section-title">Data Konsumen</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                  <div>
                    <label>Status Konsumen *</label>
                    <select id="nk_status" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="baru">Konsumen Baru</option>
                      <option value="eksisting">Konsumen Terdaftar</option>
                    </select>
                  </div>
                  <div id="row_rating" class="hidden">
                    <label>Rating *</label>
                    <select id="nk_rating" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="excellent">Excellent</option>
                      <option value="good">Good</option>
                      <option value="normal">Normal</option>
                    </select>
                  </div>
                  <div id="row_lama_kerja">
                    <label>Lama Kerja *</label>
                    <select id="nk_lama_kerja" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="kurang">Kurang dari 1 Tahun</option>
                      <option value="1tahun">1 Tahun atau Lebih</option>
                      <option value="6bulan">6 Bulan</option>
                    </select>
                  </div>
                  <div>
                    <label>Status Rumah *</label>
                    <select id="nk_rumah" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="sendiri">Milik Sendiri/Keluarga</option>
                      <option value="sewa">Sewa/Kontrak/Kost</option>
                    </select>
                  </div>
                  <div id="row_lama_tinggal" class="hidden">
                    <label>Lama Tinggal (Bulan) *</label>
                    <input type="number" id="nk_lama_tinggal" class="form-input" placeholder="Jumlah bulan">
                  </div>
                  <div id="row_region" class="hidden">
                    <label>Region *</label>
                    <select id="nk_region" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="lainnya">Lainnya</option>
                      <option value="jabodebek">Jabodebek</option>
                      <option value="banten">Banten</option>
                      <option value="kalimantan">Kalimantan</option>
                      <option value="sulawesi">Sulawesi</option>
                      <option value="jatim_bnt">Jatim BNT</option>
                      <option value="sumbagut">Sumbagut</option>
                      <option value="sumbagsel">Sumbagsel</option>
                      <option value="jabar">Jabar</option>
                      <option value="jatengut">Jateng Utara</option>
                      <option value="jatengsel">Jateng Selatan</option>
                    </select>
                  </div>
                  <div id="row_usia_kons" class="hidden">
                    <label>Usia Konsumen (Tahun) *</label>
                    <input type="number" id="nk_usia_kons" class="form-input" placeholder="Contoh: 35">
                  </div>
                </div>
              </div>

              <!-- Hasil Pengecekan Data -->
              <div>
                <h3 class="section-title emerald">Hasil Pengecekan Data</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                  <div id="row_dukcapil" class="hidden">
                    <label>Dukcapil *</label>
                    <select id="nk_dukcapil" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="match">Match</option>
                      <option value="notmatch">Not Match</option>
                    </select>
                  </div>
                  <div>
                    <label>KBIJ Pemohon *</label>
                    <select id="nk_kbij" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="yes">Yes</option>
                      <option value="no">No</option>
                      <option value="notfound">Not Found</option>
                    </select>
                  </div>
                  <div id="row_kbij_pas" class="hidden">
                    <label>KBIJ Pasangan *</label>
                    <select id="nk_kbij_pas" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="yes">Yes</option>
                      <option value="no">No</option>
                      <option value="notfound">Not Found</option>
                      <option value="tidakada">Tidak Ada Pasangan</option>
                    </select>
                  </div>
                  <div id="row_kbij_no_bd" class="hidden">
                    <label>Baki Debet KBIJ *</label>
                    <select id="nk_kbij_bd" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="gt30">> Rp 30.000.000</option>
                      <option value="lte30">&lt;= Rp 30.000.000</option>
                    </select>
                  </div>
                  <div id="row_kbij_no_dpd" class="hidden">
                    <label>DPD KBIJ *</label>
                    <select id="nk_kbij_dpd" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="gt60">> 60 Hari</option>
                      <option value="lte60">&lt;= 60 Hari</option>
                    </select>
                  </div>
                  <div id="row_kbij_no_slik" class="hidden">
                    <label>Cek SLIK *</label>
                    <select id="nk_kbij_slik" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="ya">Sudah</option>
                      <option value="tidak">Belum</option>
                    </select>
                  </div>
                  <div>
                    <label>Internal Neg List *</label>
                    <select id="nk_internal" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="tidak">Tidak Termasuk</option>
                      <option value="ya">Termasuk</option>
                    </select>
                  </div>
                  <div>
                    <label>Riwayat TB/WO *</label>
                    <select id="nk_tbwo" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="tidak">Tidak Pernah</option>
                      <option value="ya">Pernah</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- BPJS -->
              <div id="row_bpjs" class="hidden">
                <h3 class="section-title emerald">Pengecekan BPJS</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div>
                    <label>Status BPJS *</label>
                    <select id="nk_bpjs_status" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="terdaftar">Terdaftar</option>
                      <option value="tidak">Tidak Terdaftar</option>
                    </select>
                  </div>
                  <div>
                    <label>Validasi Penghasilan JMO *</label>
                    <select id="nk_bpjs_income" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="ya">Ya (Tervalidasi)</option>
                      <option value="tidak">Tidak</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Keuangan -->
              <div>
                <h3 class="section-title gold">Keuangan</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                  <div id="row_jenis_inc">
                    <label>Jenis Penghasilan *</label>
                    <select id="nk_jenis_inc" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="fixed">Fixed Income</option>
                      <option value="nonfixed">Non Fixed</option>
                    </select>
                  </div>
                  <div id="row_min_income" class="hidden">
                    <label>Minimal Income *</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="nk_min_income" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                  <div id="row_angsuran" class="hidden">
                    <label>Angsuran Baru / Bulan *</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="nk_angsuran" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                  <div id="row_angs_prev" class="hidden">
                    <label>Angsuran Sebelumnya *</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="nk_angs_prev" class="form-input rp-inp" oninput="formatRupiah(this); updateNorkilUI();" placeholder="0">
                    </div>
                  </div>
                  <div>
                    <label>Total Exposure *</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="nk_exp" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                  <div id="row_tenor">
                    <label>Tenor (Bulan) *</label>
                    <input type="number" id="nk_tenor" class="form-input" placeholder="Contoh: 36">
                  </div>
                  <div id="row_iir">
                    <label>IIR (%) *</label>
                    <input type="number" id="nk_iir" class="form-input" placeholder="Contoh: 30">
                  </div>
                  <div id="row_dp_perc" class="hidden">
                    <label>Down Payment (%) *</label>
                    <input type="number" id="nk_dp_perc" class="form-input" placeholder="Contoh: 20">
                  </div>
                  <div id="row_ltv" class="hidden">
                    <label>LTV (%) *</label>
                    <input type="number" id="nk_ltv" class="form-input" placeholder="Contoh: 80">
                  </div>
                  <div id="row_max_ltv_info" class="hidden">
                    <label>Max LTV</label>
                    <div id="max_ltv_display" class="form-input bg-gradient-to-r from-[rgba(13,148,136,0.1)] to-transparent text-[var(--accent-primary)] font-bold border-[var(--accent-primary)]">-</div>
                  </div>
                  <div id="row_max_angsuran_info" class="hidden">
                    <label>Maksimal Angsuran</label>
                    <div id="max_angsuran_display" class="form-input bg-gradient-to-r from-[rgba(13,148,136,0.1)] to-transparent text-[var(--accent-primary)] font-bold border-[var(--accent-primary)]">-</div>
                  </div>
                </div>
              </div>

              <!-- Data Kendaraan -->
              <div id="row_kendaraan">
                <h3 class="section-title coral">Data Kendaraan</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                  <div id="row_jenis_kend" class="hidden">
                    <label>Jenis Kendaraan *</label>
                    <select id="nk_jenis_kend" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="passenger">Passenger Car</option>
                      <option value="commercial">Commercial Car</option>
                    </select>
                  </div>
                  <div id="row_kategori_kend" class="hidden">
                    <label>Kategori *</label>
                    <select id="nk_kategori" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="A">Kategori A</option>
                      <option value="B">Kategori B</option>
                      <option value="C">Kategori C</option>
                    </select>
                  </div>
                  <div id="row_usia_kend" class="hidden">
                    <label>Usia Kendaraan (Tahun) *</label>
                    <input type="number" id="nk_usia_kend" class="form-input" placeholder="5" onchange="updateNorkilUI()">
                  </div>
                  <div id="row_type_motor" class="hidden">
                    <label>Tipe Kendaraan *</label>
                    <select id="nk_type_motor" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="standar">Standar (Beat, Scoopy, Vario 125, Mio, dll)</option>
                      <option value="premium">Premium (PCX/ADV/NMAX/CBR/R15/dll)</option>
                    </select>
                  </div>
                  <div id="row_bpkb" class="hidden">
                    <label>Kepemilikan BPKB *</label>
                    <select id="nk_bpkb" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="sendiri">Sendiri/Pasangan/Ortu</option>
                      <option value="oranglain">Orang Lain</option>
                    </select>
                  </div>
                  <div id="row_pajak" class="hidden">
                    <label>Pajak Kendaraan *</label>
                    <select id="nk_pajak" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="hidup">Hidup/Aktif</option>
                      <option value="mati">Mati/Expired</option>
                    </select>
                  </div>
                  <div id="row_faktur" class="hidden">
                    <label>Faktur Kendaraan *</label>
                    <select id="nk_faktur" class="form-input" onchange="updateNorkilUI()">
                      <option value="">-- Pilih --</option>
                      <option value="ada">Ada</option>
                      <option value="tidak">Tidak Ada</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Dokumen -->
              <div>
                <h3 class="section-title">Dokumen Persyaratan</h3>
                <div id="doc_check_container" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
              </div>

              <!-- Submit Button -->
              <div class="pt-4 flex justify-end">
                <button onclick="checkNorkil()" class="btn-primary">Cek Kelayakan</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Result Panel -->
        <div class="col-span-12 lg:col-span-4">
          <div class="sticky top-28">
            <div class="card p-6 result-container">
              <h3 class="section-title">Hasil Analisa</h3>
              <div id="res-norkil" class="empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                </svg>
                <p class="text-sm font-medium">Isi semua form untuk memulai analisa</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- DEVIASI PAGE -->
    <section id="page-deviasi" class="page-section">
      <div class="grid grid-cols-12 gap-6">
        <div class="col-span-12 lg:col-span-8 space-y-6">
          <div class="card p-6">
            <div class="mb-6">
              <h2 class="font-display text-xl font-bold text-[var(--text-primary)]">Pendeteksi Deviasi</h2>
              <p class="text-sm text-[var(--text-muted)] mt-1">Isi form atau centang jenis deviasi yang terjadi. Kosongkan jika tidak ada.</p>
            </div>
            
            <!-- Info Produk & Status -->
            <div class="info-box mb-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
              <div>
                <label>Jenis Produk *</label>
                <select id="dev_prod" class="form-input" onchange="updateDeviasiUI()">
                  <option value="motorku">MotorKu</option>
                  <option value="mobilku">MobilKu</option>
                  <option value="nb">New Bike (NB)</option>
                  <option value="hajiku">HajiKu</option>
                  <option value="masku">MasKu</option>
                </select>
              </div>
              <div>
                <label>Status Konsumen *</label>
                <select id="dev_status" class="form-input" onchange="updateDeviasiUI()">
                  <option value="baru">Baru</option>
                  <option value="terdaftar">Terdaftar</option>
                </select>
              </div>
              <div id="dev_row_rating" class="hidden">
                <label>Rating Internal</label>
                <select id="dev_rating" class="form-input">
                  <option value="normal">Normal</option>
                  <option value="excellent">Excellent</option>
                  <option value="good">Good</option>
                  <option value="warning">Warning</option>
                  <option value="bad">Bad</option>
                </select>
              </div>
              <div>
                <label>Pokok Hutang / PH (Rp)</label>
                <div class="rp-wrap">
                  <span class="rp-pre">Rp</span>
                  <input type="text" id="dev_ph" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                </div>
              </div>
              <div>
                <label>Status Pengajuan</label>
                <select id="dev_is_topup" class="form-input">
                  <option value="tidak">Bukan Top Up</option>
                  <option value="ya">Top Up</option>
                </select>
              </div>
              <div>
                <label>Kepemilikan BPKB</label>
                <select id="dev_bpkb_owner" class="form-input">
                  <option value="sendiri">Sendiri/Pasangan/Ortu</option>
                  <option value="oranglain">Orang Lain</option>
                </select>
              </div>
            </div>

            <!-- Deviasi Categories -->
            <div class="dev-cat-box">
              <div class="dev-cat-header">
                <span class="dev-cat-title"><span class="dev-cat-badge">01</span> NEGATIVE LIST</span>
              </div>
              <div class="dev-cat-body">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                  <div>
                    <label>Tipe Negative List</label>
                    <select id="dev_neg_type" class="form-input">
                      <option value="external">Eksternal</option>
                      <option value="internal">Internal (WOM)</option>
                    </select>
                  </div>
                  <div>
                    <label>Kolektibilitas (Kol)</label>
                    <select id="dev_kol" class="form-input">
                      <option value="1">Kol 1</option>
                      <option value="2">Kol 2</option>
                      <option value="3">Kol 3</option>
                      <option value="4">Kol 4</option>
                      <option value="5">Kol 5</option>
                    </select>
                  </div>
                  <div>
                    <label>Baki Debet Total (Rp)</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="dev_bd_total" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                  <div>
                    <label>BD Kol 3 (Rp)</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="dev_bd_kol3" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                  <div>
                    <label>BD Kol 4 (Rp)</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="dev_bd_kol4" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                  <div>
                    <label>BD Kol 5 (Rp)</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="dev_bd_kol5" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                </div>
                <div class="text-xs text-[var(--text-muted)] mt-2">Jika Kol 5, sistem akan menjumlahkan BD Kol 3 + 4 + 5 bila diisi.</div>
              </div>
            </div>

            <div class="dev-cat-box">
              <div class="dev-cat-header">
                <span class="dev-cat-title"><span class="dev-cat-badge">02</span> DSR, IIR & MIN PENGHASILAN</span>
              </div>
              <div class="dev-cat-body">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div>
                    <label>DSR (%)</label>
                    <input type="text" id="dev_dsr" class="form-input" placeholder="Contoh: 80,15">
                  </div>
                  <div>
                    <label>IIR (%)</label>
                    <input type="text" id="dev_iir" class="form-input" placeholder="Contoh: 45,50">
                  </div>
                  <div>
                    <label>Penghasilan (Rp)</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="dev_income" class="form-input rp-inp" oninput="formatRupiah(this)" placeholder="0">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="dev-cat-box">
              <div class="dev-cat-header">
                <span class="dev-cat-title"><span class="dev-cat-badge">03</span> SKEMA PRODUK PEMBIAYAAN</span>
              </div>
              <div class="dev-cat-body space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                  <div>
                    <label>Tenor (Bulan)</label>
                    <input type="number" id="dev_tenor" class="form-input" placeholder="Contoh: 50">
                  </div>
                  <div>
                    <label>LTV (%)</label>
                    <input type="text" id="dev_ltv" class="form-input" placeholder="Contoh: 86,50">
                  </div>
                  <div>
                    <label>Down Payment (%)</label>
                    <input type="text" id="dev_dp" class="form-input" placeholder="Contoh: 12,5">
                  </div>
                  <div>
                    <label>Jenis Kendaraan</label>
                    <select id="dev_jenis_kend" class="form-input" onchange="updateDeviasiUI()">
                      <option value="motor">Motor</option>
                      <option value="passenger">Passenger</option>
                      <option value="commercial">Commercial</option>
                    </select>
                  </div>
                  <div>
                    <label>Kategori Kendaraan</label>
                    <select id="dev_kategori" class="form-input" onchange="updateDeviasiUI()">
                      <option value="A">Kategori A</option>
                      <option value="B">Kategori B</option>
                      <option value="C">Kategori C</option>
                    </select>
                  </div>
                  <div>
                    <label>Usia Kendaraan (Tahun)</label>
                    <input type="number" id="dev_usia_kend" class="form-input" placeholder="Contoh: 8">
                  </div>
                  <div>
                    <label>Take Over Fincoy</label>
                    <select id="dev_to" class="form-input">
                      <option value="">-- Tidak Ada --</option>
                      <option value="current">Current</option>
                      <option value="tidakcurrent">Tidak Current</option>
                    </select>
                  </div>
                  <div>
                    <label>Max LTV Otomatis</label>
                    <div id="dev_max_ltv_display" class="form-input bg-gradient-to-r from-[rgba(13,148,136,0.1)] to-transparent text-[var(--accent-primary)] font-bold border-[var(--accent-primary)]">-</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="dev-cat-box">
              <div class="dev-cat-header">
                <span class="dev-cat-title"><span class="dev-cat-badge">04</span> UNIT PEMBIAYAAN (AGUNAN)</span>
              </div>
              <div class="dev-cat-body grid grid-cols-1 md:grid-cols-2 gap-x-4">
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_faktur">
                  <div><span class="font-semibold text-[var(--text-primary)]">Faktur Tidak Ada</span><div class="text-xs text-[var(--text-muted)]">C040321(M)</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_unit">
                  <div><span class="font-semibold text-[var(--text-primary)]">Unit Diluar Ketentuan</span><div class="text-xs text-[var(--text-muted)]">C040621(A/M)</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_kir">
                  <div><span class="font-semibold text-[var(--text-primary)]">KIR Tidak Aktif</span><div class="text-xs text-[var(--text-muted)]">C040821(M) - hanya Mobil Passenger</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_plat">
                  <div><span class="font-semibold text-[var(--text-primary)]">Plat Beda Provinsi</span><div class="text-xs text-[var(--text-muted)]">RD585(M)</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_agunan_beda">
                  <div><span class="font-semibold text-[var(--text-primary)]">Agunan Berbeda dengan BPKB (Modif)</span><div class="text-xs text-[var(--text-muted)]">C041021(M)</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_kwitansi">
                  <div><span class="font-semibold text-[var(--text-primary)]">Kwitansi Jual Beli Tidak Ada</span><div class="text-xs text-[var(--text-muted)]">C041221(M)</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_luar_kota">
                  <div><span class="font-semibold text-[var(--text-primary)]">Foto Kendaraan di Luar Kota</span><div class="text-xs text-[var(--text-muted)]">C040123/C040222</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_04_unit_motor">
                  <div><span class="font-semibold text-[var(--text-primary)]">Maks Unit Motor Diluar Ketentuan</span><div class="text-xs text-[var(--text-muted)]">C040621(A/M) - NB/MotorKu</div></div>
                </label>
              </div>
            </div>

            <div class="dev-cat-box">
              <div class="dev-cat-header">
                <span class="dev-cat-title"><span class="dev-cat-badge">05</span> PROFIL KONSUMEN</span>
              </div>
              <div class="dev-cat-body">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div>
                    <label>Usia Pemohon (Tahun)</label>
                    <input type="number" id="dev_usia" class="form-input" placeholder="Contoh: 65">
                  </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 mt-3">
                  <label class="custom-check">
                    <input type="checkbox" id="dev_05_sensitive">
                    <div><span class="font-semibold text-[var(--text-primary)]">Sensitive Employee / PEP</span><div class="text-xs text-[var(--text-muted)]">C050421(M)</div></div>
                  </label>
                  <label class="custom-check">
                    <input type="checkbox" id="dev_05_lamakerja">
                    <div><span class="font-semibold text-[var(--text-primary)]">Lama Bekerja/Usaha Diluar Ketentuan</span><div class="text-xs text-[var(--text-muted)]">C050521(M)</div></div>
                  </label>
                  <label class="custom-check">
                    <input type="checkbox" id="dev_05_ao">
                    <div><span class="font-semibold text-[var(--text-primary)]">Periode AO/Top Up &lt; 6 Bulan</span><div class="text-xs text-[var(--text-muted)]">C050621(A)</div></div>
                  </label>
                  <label class="custom-check">
                    <input type="checkbox" id="dev_05_telp">
                    <div><span class="font-semibold text-[var(--text-primary)]">No Telepon Rumah Kontrak Tidak Ada</span><div class="text-xs text-[var(--text-muted)]">C050821(M)</div></div>
                  </label>
                  <label class="custom-check">
                    <input type="checkbox" id="dev_05_sewa">
                    <div><span class="font-semibold text-[var(--text-primary)]">Lama Kontrak/Sewa &lt; 1 Tahun</span><div class="text-xs text-[var(--text-muted)]">C050921(M)</div></div>
                  </label>
                  <label class="custom-check">
                    <input type="checkbox" id="dev_05_to_od30">
                    <div><span class="font-semibold text-[var(--text-primary)]">Take Over OD s.d 30 Hari Non Restrukturisasi</span><div class="text-xs text-[var(--text-muted)]">RD591(M)</div></div>
                  </label>
                  <label id="dev_05_masku_wrap" class="custom-check hidden">
                    <input type="checkbox" id="dev_05_masku_risk">
                    <div><span class="font-semibold text-[var(--text-primary)]">Profil/Usaha Konsumen Berisiko Tinggi (MasKu)</span><div class="text-xs text-[var(--text-muted)]">LM050221(M)</div></div>
                  </label>
                </div>
              </div>
            </div>

            <div class="dev-cat-box">
              <div class="dev-cat-header">
                <span class="dev-cat-title"><span class="dev-cat-badge">06</span> COVER AREA & RED AREA</span>
              </div>
              <div class="dev-cat-body grid grid-cols-1 md:grid-cols-2 gap-x-4">
                <label class="custom-check">
                  <input type="checkbox" id="dev_06_red">
                  <div><span class="font-semibold text-[var(--text-primary)]">Red Area</span><div class="text-xs text-[var(--text-muted)]">C060121(M)</div><span class="dev-note">Rekomendasi Collection wajib (kecuali terdaftar)</span></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_06_cover">
                  <div><span class="font-semibold text-[var(--text-primary)]">Cover Area Tidak Sesuai Ketentuan</span><div class="text-xs text-[var(--text-muted)]">C060221(M)</div></div>
                </label>
              </div>
            </div>

            <div class="dev-cat-box">
              <div class="dev-cat-header">
                <span class="dev-cat-title"><span class="dev-cat-badge">07</span> DOKUMEN PEMBIAYAAN</span>
              </div>
              <div class="dev-cat-body grid grid-cols-1 md:grid-cols-2 gap-x-4">
                <label class="custom-check">
                  <input type="checkbox" id="dev_07_npwp">
                  <div><span class="font-semibold text-[var(--text-primary)]">NPWP Tidak Sesuai Ketentuan</span><div class="text-xs text-[var(--text-muted)]">C070121(A)</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_07_keuangan">
                  <div><span class="font-semibold text-[var(--text-primary)]">Dokumen Data Keuangan/Usaha Tidak Sesuai</span><div class="text-xs text-[var(--text-muted)]">C070221</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_07_mandatory">
                  <div><span class="font-semibold text-[var(--text-primary)]">Dokumen Mandatory Diluar Ketentuan</span><div class="text-xs text-[var(--text-muted)]">C070322S1</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_07_cabanglain">
                  <div><span class="font-semibold text-[var(--text-primary)]">Tanda Tangan Pembiayaan di Cabang Lain</span><div class="text-xs text-[var(--text-muted)]">C070721(M)</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_07_jandaduda">
                  <div><span class="font-semibold text-[var(--text-primary)]">Deviasi Dokumen Janda/Duda</span><div class="text-xs text-[var(--text-muted)]">RD615S1</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_07_ttd">
                  <div><span class="font-semibold text-[var(--text-primary)]">Pasangan Tidak Bisa e-Sign</span><div class="text-xs text-[var(--text-muted)]">Motor: CAC | Mobil: CAM</div></div>
                </label>
                <label class="custom-check">
                  <input type="checkbox" id="dev_07_dukcapil_blank">
                  <div><span class="font-semibold text-[var(--text-primary)]">Dukcapil Tidak Ada / Blank</span><div class="text-xs text-[var(--text-muted)]">Hanya untuk konsumen baru</div></div>
                </label>
                <div>
                  <label>Fatal Score Dukcapil/Biometric</label>
                  <select id="dev_07_fatal" class="form-input">
                    <option value="">-- Tidak Ada --</option>
                    <option value="sesuai">Sesuai</option>
                    <option value="tidaksesuai">Tidak Sesuai</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="pt-4 flex justify-end">
              <button onclick="checkDeviasi()" class="btn-primary">Cek Level Approval</button>
            </div>
          </div>
        </div>

        <!-- Deviasi Result Panel -->
        <div class="col-span-12 lg:col-span-4">
          <div class="sticky top-28">
            <div class="card p-6 result-container">
              <h3 class="section-title emerald">Hasil Deteksi Deviasi</h3>
              <div id="res-deviasi" class="empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <p class="text-sm font-medium">Menunggu input</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SUPER PAGE -->
    <section id="page-super" class="page-section">
      <div class="grid grid-cols-12 gap-6">
        <div class="col-span-12 lg:col-span-8 space-y-6">
          <div class="card p-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b border-[rgba(148,163,184,0.15)] pb-4 gap-3">
              <div>
                <h2 class="font-display text-xl font-bold text-[var(--text-primary)]">MobilKu Super</h2>
                <p class="text-xs text-[var(--text-muted)]">Program Khusus</p>
              </div>
              <div class="flex bg-[#f1f5f9] rounded-xl p-1">
                <button id="super-ro" onclick="setSuperType('ro')" class="super-tab active">RO Super</button>
                <button id="super-to" onclick="setSuperType('to')" class="super-tab">Take Over</button>
                <button id="super-nc" onclick="setSuperType('nc')" class="super-tab">NC Super</button>
              </div>
            </div>

            <div class="space-y-6">
              <!-- Data Konsumen -->
              <div>
                <h3 class="section-title">Data Konsumen</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                  <div id="sp_row_jenis_kons" class="hidden">
                    <label>Jenis Konsumen *</label>
                    <select id="sp_jenis_kons" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="terdaftar">Konsumen Terdaftar</option>
                      <option value="baru">Konsumen Baru</option>
                    </select>
                  </div>
                  <div id="sp_row_rating_super">
                    <label>Rating Konsumen *</label>
                    <select id="sp_rating" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="excellent">Excellent</option>
                      <option value="good">Good</option>
                      <option value="normal">Normal</option>
                      <option value="warning">Warning</option>
                      <option value="bad">Bad Customer</option>
                    </select>
                  </div>
                  <div id="sp_row_usia_super">
                    <label>Usia Pemohon *</label>
                    <input type="number" id="sp_usia" class="form-input" placeholder="Tahun">
                  </div>
                  <div>
                    <label>Jenis Pekerjaan *</label>
                    <select id="sp_kerja" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="karyawan">Karyawan</option>
                      <option value="wiraswasta">Wiraswasta</option>
                    </select>
                  </div>
                  <div>
                    <label>Status Rumah *</label>
                    <select id="sp_rumah" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="milik">Milik Sendiri/Keluarga</option>
                      <option value="sewa">Sewa/Kontrak/Kost</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Negative List -->
              <div>
                <h3 class="section-title coral">Pengecekan Negative List</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                  <div>
                    <label>KBIJ Pemohon *</label>
                    <select id="sp_kbij" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="yes">Yes</option>
                      <option value="no">No</option>
                      <option value="notfound">Not Found</option>
                    </select>
                  </div>
                  <div>
                    <label>Internal Neg List *</label>
                    <select id="sp_internal" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="tidak">Tidak Termasuk</option>
                      <option value="ya">Termasuk</option>
                    </select>
                  </div>
                  <div>
                    <label>Riwayat TB/WO *</label>
                    <select id="sp_tbwo" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="tidak">Tidak Pernah</option>
                      <option value="ya">Pernah</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Keuangan -->
              <div>
                <h3 class="section-title gold">Keuangan</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div>
                    <label>IIR (%) *</label>
                    <input type="number" id="sp_iir" class="form-input" placeholder="30">
                    <div id="sp_iir_note" class="text-xs text-[var(--text-muted)] mt-1">Max: 40% (RO)</div>
                  </div>
                  <div>
                    <label>Maksimal LTV (%) *</label>
                    <input type="number" id="sp_ltv" class="form-input" placeholder="90">
                    <div id="sp_ltv_note" class="text-xs text-[var(--text-muted)] mt-1">Max: 90%</div>
                  </div>
                  <div>
                    <label>Tenor (Bulan) *</label>
                    <input type="number" id="sp_tenor" class="form-input" placeholder="48">
                  </div>
                  <div>
                    <label>Total Exposure *</label>
                    <div class="rp-wrap">
                      <span class="rp-pre">Rp</span>
                      <input type="text" id="sp_exp" class="form-input rp-inp" oninput="formatRupiah(this)">
                    </div>
                    <div class="text-xs text-[var(--text-muted)] mt-1">Max: Rp 250.000.000</div>
                  </div>
                </div>
              </div>

              <!-- Data Kendaraan -->
              <div>
                <h3 class="section-title coral">Data Kendaraan</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div>
                    <label>Jenis Kendaraan *</label>
                    <select id="sp_jenis" class="form-input" onchange="updateSuperUI()">
                      <option value="">-- Pilih --</option>
                      <option value="passenger">Passenger</option>
                      <option value="commercial">Commercial</option>
                    </select>
                  </div>
                  <div>
                    <label>Usia Kendaraan (Tahun) *</label>
                    <input type="number" id="sp_usia_kend" class="form-input" placeholder="5">
                    <div id="sp_usia_note" class="text-xs text-[var(--text-muted)] mt-1">Max: 17 tahun (RO Passenger)</div>
                  </div>
                  <div>
                    <label>Kepemilikan BPKB *</label>
                    <select id="sp_bpkb" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="sendiri">Sendiri/Pasangan/Ortu</option>
                      <option value="oranglain">Orang Lain</option>
                    </select>
                  </div>
                  <div>
                    <label>Status STNK *</label>
                    <select id="sp_stnk" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="hidup">Hidup</option>
                      <option value="mati">Mati</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- TO Specific -->
              <div id="row_to_specific" class="hidden">
                <h3 class="section-title">Data Take Over</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div>
                    <label>Kategori Kendaraan *</label>
                    <select id="sp_to_kategori" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="A">Kategori A</option>
                      <option value="B">Kategori B</option>
                      <option value="C">Kategori C</option>
                    </select>
                  </div>
                  <div>
                    <label>Angsuran Dibayar (Bulan) *</label>
                    <input type="number" id="sp_to_bayar" class="form-input" placeholder="12">
                  </div>
                  <div>
                    <label>Maksimal Overdue *</label>
                    <select id="sp_to_od" class="form-input">
                      <option value="">-- Pilih --</option>
                      <option value="kurang">Kurang dari 14 Hari</option>
                      <option value="lebih">Lebih dari 14 Hari</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- NC Specific -->
              <div id="row_nc_specific" class="hidden">
                <h3 class="section-title">Data NC Super</h3>
                <div class="text-sm text-[var(--text-secondary)]">Tidak ada field tambahan untuk NC Super.</div>
              </div>

              <!-- Dokumen -->
              <div>
                <h3 class="section-title">Dokumen Pembiayaan</h3>
                <div id="doc_super_container" class="grid grid-cols-2 gap-3"></div>
              </div>

              <div class="pt-4 flex justify-end">
                <button onclick="checkSuper()" class="btn-primary">Cek Kelayakan Super</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Super Result Panel -->
        <div class="col-span-12 lg:col-span-4">
          <div class="sticky top-28">
            <div class="card p-6 result-container">
              <h3 class="section-title coral">Hasil Evaluasi</h3>
              <div id="res-super" class="empty-state">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                </svg>
                <p class="text-sm font-medium">Isi semua form untuk memulai evaluasi</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <script>
    /* ===== UTILITIES ===== */
    const $ = (id) => document.getElementById(id);
    const formatRupiah = (input) => { 
      let value = input.value.replace(/\D/g, ''); 
      input.value = new Intl.NumberFormat('id-ID').format(value); 
    };
    const parseNum = (str) => { 
      if (!str) return 0; 
      return parseInt(str.toString().replace(/\D/g, ''), 10) || 0; 
    };
    const parseDecimal = (str) => {
      if (str === null || str === undefined) return 0;
      let cleaned = str.toString().trim().replace(/%/g, '').replace(/\s/g, '');
      if (cleaned.includes(',') && cleaned.includes('.')) {
        if (cleaned.lastIndexOf(',') > cleaned.lastIndexOf('.')) cleaned = cleaned.replace(/\./g, '').replace(',', '.');
        else cleaned = cleaned.replace(/,/g, '');
      } else {
        cleaned = cleaned.replace(',', '.');
      }
      const num = parseFloat(cleaned);
      return Number.isFinite(num) ? num : 0;
    };
    const getVal = (id) => $(id) ? $(id).value : '';
    const formatCurr = (num) => 'Rp ' + new Intl.NumberFormat('id-ID').format(num);

    /* ===== NAVIGATION ===== */
    function navigatePage(pageName) {
      document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
      $('page-' + pageName).classList.add('active');
      $('btn-' + pageName).classList.add('active');
    }

    /* ===== NORMAL KILAT ===== */
    let currentProduct = 'mobilku';
    
    const dokumenProduk = {
      mobilku: [
        { id: 'doc_ktp', label: 'E-KTP', mandatory: true },
        { id: 'doc_kk', label: 'Kartu Keluarga', mandatory: true },
        { id: 'doc_rumah', label: 'Bukti Kepemilikan Rumah (SKD)', mandatory: true },
        { id: 'doc_income', label: 'Bukti Penghasilan', mandatory: true },
        { id: 'doc_npwp', label: 'NPWP (jika >50 Juta)', mandatory: false }
      ],
      motorku: [
        { id: 'doc_ktp', label: 'E-KTP', mandatory: true },
        { id: 'doc_kk', label: 'Kartu Keluarga', mandatory: true },
        { id: 'doc_rumah', label: 'Bukti Kepemilikan Rumah', mandatory: true },
        { id: 'doc_income', label: 'Bukti Penghasilan', mandatory: true }
      ],
      newbike_bpjs: [
        { id: 'doc_ktp', label: 'E-KTP', mandatory: true },
        { id: 'doc_kk', label: 'Kartu Keluarga', mandatory: true },
        { id: 'doc_rumah', label: 'Bukti Kepemilikan Rumah', mandatory: true },
        { id: 'doc_bpjs', label: 'Bukti BPJS / SS JMO', mandatory: true }
      ],
      newbike_nonbpjs: [
        { id: 'doc_ktp', label: 'E-KTP', mandatory: true },
        { id: 'doc_kk', label: 'Kartu Keluarga', mandatory: true },
        { id: 'doc_rumah', label: 'Bukti Kepemilikan Rumah', mandatory: true },
        { id: 'doc_income', label: 'Bukti Penghasilan', mandatory: true }
      ]
    };

    const motorkuMaxAngsuranByRegion = {
      jabodebek: 1500000,
      banten: 1500000,
      kalimantan: 1500000,
      sulawesi: 1500000,
      jatim_bnt: 1250000,
      sumbagut: 1250000,
      sumbagsel: 1350000,
      jabar: 1200000,
      jatengut: 1000000,
      jatengsel: 1000000
    };

    const nbNonBpjsMaxAngsuranByType = {
      standar: {
        jabodebek: 1350000,
        banten: 1350000,
        sulawesi: 1350000,
        sumbagut: 1350000,
        sumbagsel: 1350000,
        kalimantan: 1500000,
        jabar: 1000000,
        jatengut: 1000000,
        jatengsel: 1000000,
        jatim_bnt: 1000000
      },
      premium: {
        jabodebek: 1350000,
        banten: 1350000,
        sulawesi: 1350000,
        sumbagut: 1350000,
        sumbagsel: 1350000,
        kalimantan: 1500000,
        jabar: 1000000,
        jatengut: 1000000,
        jatengsel: 1000000,
        jatim_bnt: 1000000
      }
    };

    function getMotorkuMaxAngsuran(region) {
      return motorkuMaxAngsuranByRegion[region] || null;
    }

    function getNBNonBpjsMaxAngsuran(region, typeMotor) {
      const mapByType = nbNonBpjsMaxAngsuranByType[typeMotor] || nbNonBpjsMaxAngsuranByType.standar;
      return mapByType[region] || null;
    }

    function getMotorkuBaseMaxLTV(status, rating, usiaKend) {
      if (!usiaKend || usiaKend <= 0) return null;
      if (usiaKend > 12) return null;
      if (status === 'baru') return usiaKend <= 10 ? 85 : 80;
      if (rating === 'excellent' || rating === 'good') return usiaKend <= 10 ? 90 : 85;
      return usiaKend <= 10 ? 85 : 80;
    }

    function getMotorkuEffectiveMaxLTV() {
      const status = getVal('nk_status');
      const rating = getVal('nk_rating');
      const region = getVal('nk_region');
      const kbij = getVal('nk_kbij');
      const faktur = getVal('nk_faktur');
      const pajak = getVal('nk_pajak');
      const usiaKend = parseNum(getVal('nk_usia_kend'));

      let maxLTV = getMotorkuBaseMaxLTV(status, rating, usiaKend);
      if (maxLTV === null) return { maxLTV: null };

      if (kbij === 'no' && (status === 'baru' || rating === 'normal')) maxLTV = Math.min(maxLTV, 70);
      if (faktur === 'tidak') maxLTV -= 5;
      if (pajak === 'mati' && region === 'jatim_bnt') maxLTV -= 10;

      return { maxLTV: Math.max(0, maxLTV) };
    }

    function getMobilkuMaxLTV(usiaKend, bpkb) {
      if (!usiaKend || usiaKend <= 0 || usiaKend > 10) return null;
      if (usiaKend <= 5) return bpkb === 'sendiri' ? 80 : 70;
      return bpkb === 'sendiri' ? 70 : 60;
    }

    function selectProduct(prod) {
      currentProduct = prod;
      document.querySelectorAll('.prod-item').forEach(c => c.classList.remove('active'));
      $('prod-' + prod).classList.add('active');
      updateNorkilUI();
      renderDokumen();
    }

    function renderDokumen() {
      const container = $('doc_check_container');
      const docs = dokumenProduk[currentProduct] || [];
      container.innerHTML = docs.map(doc => `
        <label class="custom-check">
          <input type="checkbox" id="${doc.id}">
          <div><span class="font-semibold text-[var(--text-primary)]">${doc.label}</span>${doc.mandatory ? '<span class="text-[var(--accent-coral)] text-xs ml-1">*</span>' : ''}</div>
        </label>
      `).join('');
    }

    function updateNorkilUI() {
      const status = getVal('nk_status');
      const rumah = getVal('nk_rumah');
      const kbij = getVal('nk_kbij');

      $('row_rating').classList.toggle('hidden', status !== 'eksisting');
      $('row_lama_tinggal').classList.toggle('hidden', rumah !== 'sewa');

      const rowsToHide = [
        'row_region', 'row_bpjs', 'row_dukcapil', 'row_kbij_pas', 'row_kbij_no_bd', 'row_kbij_no_dpd', 'row_kbij_no_slik',
        'row_jenis_kend', 'row_kategori_kend', 'row_usia_kend', 'row_type_motor', 'row_bpkb', 'row_pajak',
        'row_faktur', 'row_ltv', 'row_max_ltv_info', 'row_dp_perc', 'row_usia_kons', 'row_lama_kerja',
        'row_jenis_inc', 'row_tenor', 'row_iir', 'row_min_income', 'row_angsuran', 'row_angs_prev',
        'row_max_angsuran_info'
      ];
      rowsToHide.forEach(id => {
        if ($(id)) $(id).classList.add('hidden');
      });

      if ($('row_kendaraan')) $('row_kendaraan').classList.remove('hidden');

      if (currentProduct === 'mobilku') {
        $('row_lama_kerja').classList.remove('hidden');
        $('row_jenis_inc').classList.remove('hidden');
        $('row_tenor').classList.remove('hidden');
        $('row_iir').classList.remove('hidden');
        $('row_dukcapil').classList.remove('hidden');
        $('row_kbij_pas').classList.remove('hidden');
        $('row_jenis_kend').classList.remove('hidden');
        $('row_kategori_kend').classList.remove('hidden');
        $('row_usia_kend').classList.remove('hidden');
        $('row_bpkb').classList.remove('hidden');
        $('row_pajak').classList.remove('hidden');
        $('row_ltv').classList.remove('hidden');
        $('row_max_ltv_info').classList.remove('hidden');
        updateMaxLTVDisplay();
      } else if (currentProduct === 'motorku') {
        $('row_region').classList.remove('hidden');
        $('row_usia_kons').classList.remove('hidden');
        $('row_usia_kend').classList.remove('hidden');
        $('row_bpkb').classList.remove('hidden');
        $('row_pajak').classList.remove('hidden');
        $('row_faktur').classList.remove('hidden');
        $('row_ltv').classList.remove('hidden');
        $('row_max_ltv_info').classList.remove('hidden');
        $('row_angsuran').classList.remove('hidden');
        $('row_max_angsuran_info').classList.remove('hidden');
        if (status === 'baru') $('row_min_income').classList.remove('hidden');
        if (status === 'eksisting') $('row_angs_prev').classList.remove('hidden');
        if (kbij === 'no') {
          $('row_kbij_no_bd').classList.remove('hidden');
          $('row_kbij_no_dpd').classList.remove('hidden');
        }
        updateMaxLTVDisplay();
        updateMaxAngsuranDisplay();
      } else if (currentProduct === 'newbike_bpjs') {
        $('row_lama_kerja').classList.remove('hidden');
        $('row_tenor').classList.remove('hidden');
        $('row_iir').classList.remove('hidden');
        $('row_bpjs').classList.remove('hidden');
        $('row_dp_perc').classList.remove('hidden');
        $('row_dukcapil').classList.remove('hidden');
        $('row_kbij_pas').classList.remove('hidden');
        if (kbij === 'no') {
          $('row_kbij_no_bd').classList.remove('hidden');
          $('row_kbij_no_dpd').classList.remove('hidden');
          $('row_kbij_no_slik').classList.remove('hidden');
        }
        if ($('row_kendaraan')) $('row_kendaraan').classList.add('hidden');
      } else if (currentProduct === 'newbike_nonbpjs') {
        $('row_jenis_inc').classList.remove('hidden');
        $('row_tenor').classList.remove('hidden');
        $('row_iir').classList.remove('hidden');
        $('row_dp_perc').classList.remove('hidden');
        $('row_region').classList.remove('hidden');
        $('row_kbij_pas').classList.remove('hidden');
        $('row_type_motor').classList.remove('hidden');
        $('row_angsuran').classList.remove('hidden');
        $('row_max_angsuran_info').classList.remove('hidden');
        if (kbij === 'no') {
          $('row_kbij_no_bd').classList.remove('hidden');
          $('row_kbij_no_dpd').classList.remove('hidden');
          $('row_kbij_no_slik').classList.remove('hidden');
        }
        if (status === 'eksisting') $('row_angs_prev').classList.remove('hidden');
        updateMaxAngsuranDisplay();
      }
    }

    function updateMaxLTVDisplay() {
      let maxLTV = null;
      if (currentProduct === 'mobilku') {
        maxLTV = getMobilkuMaxLTV(parseNum(getVal('nk_usia_kend')), getVal('nk_bpkb'));
      } else if (currentProduct === 'motorku') {
        maxLTV = getMotorkuEffectiveMaxLTV().maxLTV;
      }
      $('max_ltv_display').textContent = Number.isFinite(maxLTV) ? `${maxLTV}%` : '-';
    }

    function updateMaxAngsuranDisplay() {
      let text = '-';
      const status = getVal('nk_status');
      const region = getVal('nk_region');
      const prev = parseNum(getVal('nk_angs_prev'));

      if (currentProduct === 'motorku') {
        if (status === 'baru') {
          const maxAngsuran = getMotorkuMaxAngsuran(region);
          if (maxAngsuran) text = `${formatCurr(maxAngsuran)} / bulan`;
        } else if (status === 'eksisting') {
          if (prev > 0) text = `${formatCurr(Math.floor(prev * 1.5))} (1,5x angsuran sebelumnya)`;
          else text = 'Isi angsuran sebelumnya untuk batas 1,5x';
        }
      } else if (currentProduct === 'newbike_nonbpjs') {
        if (status === 'baru') {
          const maxAngsuran = getNBNonBpjsMaxAngsuran(region, getVal('nk_type_motor'));
          if (maxAngsuran) text = `${formatCurr(maxAngsuran)} / bulan`;
        } else if (status === 'eksisting') {
          if (prev > 0) text = `${formatCurr(Math.floor(prev * 1.5))} (1,5x angsuran sebelumnya)`;
          else text = 'Isi angsuran sebelumnya untuk batas 1,5x';
        }
      }

      $('max_angsuran_display').textContent = text;
    }

    function validateNorkilInputs() {
      const missing = [];
      const requireField = (id, label) => {
        if (!getVal(id)) missing.push(label);
      };

      const status = getVal('nk_status');
      const rumah = getVal('nk_rumah');
      const kbij = getVal('nk_kbij');

      requireField('nk_status', 'Status Konsumen');
      requireField('nk_rumah', 'Status Rumah');
      requireField('nk_kbij', 'KBIJ Pemohon');
      requireField('nk_internal', 'Internal Neg List');
      requireField('nk_tbwo', 'Riwayat TB/WO');
      requireField('nk_exp', 'Total Exposure');

      if (status === 'eksisting') requireField('nk_rating', 'Rating');
      if (rumah === 'sewa') requireField('nk_lama_tinggal', 'Lama Tinggal');

      if (currentProduct === 'mobilku') {
        requireField('nk_lama_kerja', 'Lama Kerja');
        requireField('nk_jenis_inc', 'Jenis Penghasilan');
        requireField('nk_tenor', 'Tenor');
        requireField('nk_iir', 'IIR');
        requireField('nk_dukcapil', 'Dukcapil');
        requireField('nk_kbij_pas', 'KBIJ Pasangan');
        requireField('nk_jenis_kend', 'Jenis Kendaraan');
        requireField('nk_kategori', 'Kategori Kendaraan');
        requireField('nk_usia_kend', 'Usia Kendaraan');
        requireField('nk_bpkb', 'Kepemilikan BPKB');
        requireField('nk_pajak', 'Pajak Kendaraan');
        requireField('nk_ltv', 'LTV');
      } else if (currentProduct === 'motorku') {
        requireField('nk_region', 'Region');
        requireField('nk_usia_kons', 'Usia Konsumen');
        requireField('nk_angsuran', 'Angsuran Baru');
        requireField('nk_usia_kend', 'Usia Kendaraan');
        requireField('nk_bpkb', 'Kepemilikan BPKB');
        requireField('nk_pajak', 'Pajak Kendaraan');
        requireField('nk_faktur', 'Faktur Kendaraan');
        requireField('nk_ltv', 'LTV');
        if (status === 'baru') requireField('nk_min_income', 'Minimal Income');
        if (status === 'eksisting') requireField('nk_angs_prev', 'Angsuran Sebelumnya');
        if (kbij === 'no') {
          requireField('nk_kbij_bd', 'Baki Debet KBIJ');
          requireField('nk_kbij_dpd', 'DPD KBIJ');
        }
      } else if (currentProduct === 'newbike_bpjs') {
        requireField('nk_lama_kerja', 'Lama Kerja');
        requireField('nk_tenor', 'Tenor');
        requireField('nk_iir', 'IIR');
        requireField('nk_dukcapil', 'Dukcapil');
        requireField('nk_kbij_pas', 'KBIJ Pasangan/Penjamin');
        requireField('nk_bpjs_status', 'Status BPJS');
        requireField('nk_bpjs_income', 'Validasi Penghasilan JMO');
        requireField('nk_dp_perc', 'Down Payment');
        if (kbij === 'no' && status === 'eksisting' && (getVal('nk_rating') === 'excellent' || getVal('nk_rating') === 'good')) {
          requireField('nk_kbij_bd', 'Baki Debet KBIJ');
          requireField('nk_kbij_dpd', 'DPD KBIJ');
          requireField('nk_kbij_slik', 'Cek SLIK');
        }
      } else if (currentProduct === 'newbike_nonbpjs') {
        requireField('nk_jenis_inc', 'Jenis Penghasilan');
        requireField('nk_tenor', 'Tenor');
        requireField('nk_iir', 'IIR');
        requireField('nk_dp_perc', 'Down Payment');
        requireField('nk_region', 'Region');
        requireField('nk_kbij_pas', 'KBIJ Pasangan/Penjamin');
        requireField('nk_type_motor', 'Tipe Kendaraan');
        requireField('nk_angsuran', 'Angsuran Baru');
        if (status === 'eksisting') requireField('nk_angs_prev', 'Angsuran Sebelumnya');
        if (kbij === 'no' && status === 'eksisting' && (getVal('nk_rating') === 'excellent' || getVal('nk_rating') === 'good')) {
          requireField('nk_kbij_bd', 'Baki Debet KBIJ');
          requireField('nk_kbij_dpd', 'DPD KBIJ');
          requireField('nk_kbij_slik', 'Cek SLIK');
        }
      }

      return [...new Set(missing)];
    }

    function buildNorkilSummary(data) {
      const productLabels = {
        mobilku: 'MobilKu',
        motorku: 'MotorKu',
        newbike_bpjs: 'NewBike BPJS',
        newbike_nonbpjs: 'NewBike Non-BPJS'
      };
      const statusLabels = { baru: 'Konsumen Baru', eksisting: 'Konsumen Terdaftar' };
      const ratingLabels = { excellent: 'Excellent', good: 'Good', normal: 'Normal' };

      const summary = [
        { label: 'Produk', value: productLabels[currentProduct] || currentProduct },
        { label: 'Status Konsumen', value: statusLabels[data.status] || '-' },
        { label: 'Rating', value: data.status === 'eksisting' ? (ratingLabels[data.rating] || '-') : 'Tidak Berlaku' },
        { label: 'Total Exposure', value: data.exp > 0 ? formatCurr(data.exp) : '-' },
        { label: 'Tenor', value: data.tenor > 0 ? `${data.tenor} bulan` : '-' },
        { label: 'IIR', value: data.iir > 0 ? `${data.iir}%` : '-' },
        { label: 'LTV', value: data.ltv > 0 ? `${data.ltv}%` : '-' },
        { label: 'DP', value: data.dpPerc > 0 ? `${data.dpPerc}%` : '-' },
        { label: 'Angsuran Baru', value: data.angsuran > 0 ? formatCurr(data.angsuran) : '-' }
      ];

      const maxLTVDisplay = $('max_ltv_display')?.textContent?.trim();
      if (maxLTVDisplay && maxLTVDisplay !== '-') summary.push({ label: 'Batas Max LTV', value: maxLTVDisplay });

      const maxAngsuranDisplay = $('max_angsuran_display')?.textContent?.trim();
      if (maxAngsuranDisplay && maxAngsuranDisplay !== '-') summary.push({ label: 'Batas Max Angsuran', value: maxAngsuranDisplay });

      return summary.filter(item => item.value && item.value !== '-');
    }

    function renderNorkilComplianceResult(failReasons, notes, summaryItems) {
      const container = $('res-norkil');
      const uniqueFailReasons = [...new Set(failReasons)];
      const uniqueNotes = [...new Set(notes || [])];
      const isCompliant = uniqueFailReasons.length === 0;
      const analyzedAt = new Date().toLocaleString('id-ID', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });

      let html = '<div class="space-y-4">';
      html += `<div class="status-badge ${isCompliant ? 'status-pass' : 'status-fail'} justify-center text-sm w-full">${isCompliant ? 'SESUAI DENGAN SK NORMAL KILAT YANG BERLAKU' : 'TIDAK LAYAK'}</div>`;

      html += '<div class="info-box">';
      html += '<div class="text-xs text-[var(--accent-primary)] font-bold mb-2">RINGKASAN HASIL</div>';
      html += '<div class="grid grid-cols-1 sm:grid-cols-3 gap-2 text-xs">';
      html += `<div><span class="text-[var(--text-muted)]">Poin Tidak Sesuai:</span><div class="font-bold text-[var(--accent-coral)]">${uniqueFailReasons.length}</div></div>`;
      html += `<div><span class="text-[var(--text-muted)]">Catatan:</span><div class="font-bold text-[var(--accent-gold)]">${uniqueNotes.length}</div></div>`;
      html += `<div><span class="text-[var(--text-muted)]">Waktu Analisa:</span><div class="font-bold text-[var(--text-primary)]">${analyzedAt}</div></div>`;
      html += '</div></div>';

      if (summaryItems && summaryItems.length > 0) {
        html += '<div class="result-group">';
        html += '<div class="result-header valid">Data Pengajuan</div>';
        html += '<div class="result-body"><div class="grid grid-cols-1 sm:grid-cols-2 gap-2">';
        summaryItems.forEach(item => {
          html += '<div class="rounded-lg border border-[rgba(148,163,184,0.12)] bg-[rgba(255,255,255,0.85)] p-3">';
          html += `<div class="text-[11px] text-[var(--text-muted)]">${item.label}</div>`;
          html += `<div class="text-xs font-semibold text-[var(--text-primary)] mt-1">${item.value}</div>`;
          html += '</div>';
        });
        html += '</div></div></div>';
      }

      if (!isCompliant) {
        html += '<div class="result-group">';
        html += '<div class="result-header invalid">Tidak Layak Karena</div>';
        html += '<div class="result-body"><ol class="text-xs text-[var(--text-secondary)] space-y-2 list-decimal list-inside">';
        uniqueFailReasons.forEach(reason => { html += `<li class="marker:text-[var(--accent-coral)]">${reason}</li>`; });
        html += '</ol></div></div>';
      } else {
        html += '<div class="result-group">';
        html += '<div class="result-header valid">Keterangan</div>';
        html += '<div class="result-body text-xs text-[var(--text-secondary)]">Semua parameter utama sesuai ketentuan Normal Kilat.</div>';
        html += '</div>';
      }

      if (uniqueNotes.length > 0) {
        html += '<div class="result-group">';
        html += '<div class="result-header warn">Catatan / Action Item</div>';
        html += '<div class="result-body"><ul class="text-xs text-[var(--text-secondary)] space-y-1">';
        uniqueNotes.forEach(note => { html += `<li>- ${note}</li>`; });
        html += '</ul></div></div>';
      }

      html += '</div>';
      container.innerHTML = html;
    }

    function checkNorkil() {
      const missing = validateNorkilInputs();
      if (missing.length > 0) {
        renderEmptyResult('res-norkil', 'Form Belum Lengkap', missing);
        return;
      }

      const failReasons = [];
      const notes = [];
      const addFail = (msg) => failReasons.push(msg);
      const addNote = (msg) => notes.push(msg);

      const status = getVal('nk_status');
      const rating = getVal('nk_rating');
      const rumah = getVal('nk_rumah');
      const kbij = getVal('nk_kbij');
      const exp = parseNum(getVal('nk_exp'));
      const tenor = parseNum(getVal('nk_tenor'));
      const iir = parseNum(getVal('nk_iir'));
      const ltv = parseNum(getVal('nk_ltv'));
      const dpPerc = parseNum(getVal('nk_dp_perc'));
      const angsuran = parseNum(getVal('nk_angsuran'));
      const summaryItems = buildNorkilSummary({ status, rating, exp, tenor, iir, ltv, dpPerc, angsuran });

      const docs = dokumenProduk[currentProduct] || [];
      const missingDocs = docs.filter(d => d.mandatory && !$(d.id).checked);
      if (missingDocs.length > 0) addFail('Dokumen wajib belum lengkap: ' + missingDocs.map(d => d.label).join(', '));

      if (getVal('nk_internal') === 'ya') addFail('Termasuk Internal Negative List');
      if (getVal('nk_tbwo') === 'ya') addFail('Memiliki riwayat TB/WO');

      if (currentProduct === 'mobilku') {
        if (getVal('nk_dukcapil') !== 'match') addFail('Dukcapil wajib Match');
        if (getVal('nk_lama_kerja') !== '1tahun') addFail('Lama kerja/usaha minimal 1 tahun');
        if (rumah === 'sewa') addFail('Domisili sewa/kontrak/kost tidak diperbolehkan');

        const kbijPas = getVal('nk_kbij_pas');
        if (kbij === 'no') addFail('KBIJ pemohon No tidak diperbolehkan');
        if (kbij === 'notfound' && kbijPas !== 'yes') addFail('KBIJ pemohon Not Found harus disertai KBIJ pasangan Yes');

        if (getVal('nk_jenis_kend') !== 'passenger') addFail('Jenis kendaraan harus Passenger');
        if (getVal('nk_kategori') !== 'A') addFail('Kategori kendaraan harus A');

        const usiaKend = parseNum(getVal('nk_usia_kend'));
        if (usiaKend > 10) addFail('Usia kendaraan lebih dari 10 tahun');

        const maxLTV = getMobilkuMaxLTV(usiaKend, getVal('nk_bpkb'));
        if (maxLTV === null) addFail('Usia kendaraan tidak sesuai ketentuan LTV');
        else if (ltv > maxLTV) addFail(`LTV ${ltv}% melebihi maksimal ${maxLTV}%`);

        if (exp > 175000000) addFail('Total exposure melebihi Rp 175.000.000');

        const maxIIR = getVal('nk_jenis_inc') === 'fixed' ? 40 : 30;
        if (iir > maxIIR) addFail(`IIR ${iir}% melebihi batas ${maxIIR}%`);
        if (tenor < 12 || tenor > 48) addFail('Tenor harus 12-48 bulan');

        if (getVal('nk_bpkb') === 'oranglain') addNote('BPKB atas nama orang lain wajib BBN');
        if (getVal('nk_pajak') === 'mati') addNote('Pajak kendaraan mati perlu perpanjangan sebelum pencairan');
      } else if (currentProduct === 'motorku') {
        const usiaKonsumen = parseNum(getVal('nk_usia_kons'));
        const region = getVal('nk_region');
        const pajak = getVal('nk_pajak');
        const faktur = getVal('nk_faktur');

        if (status === 'baru' && parseNum(getVal('nk_min_income')) < 2500000) addFail('Minimal income konsumen baru kurang dari Rp 2.500.000');
        if (rumah === 'sewa' && (status === 'baru' || rating === 'normal')) addFail('Domisili sewa tidak diperbolehkan untuk konsumen baru/normal');

        const maxExp = status === 'baru' ? 25000000 : 45000000;
        if (exp > maxExp) addFail(`Total exposure melebihi ${formatCurr(maxExp)}`);

        if (status === 'baru') {
          const maxAngsuran = getMotorkuMaxAngsuran(region);
          if (maxAngsuran && angsuran > maxAngsuran) addFail(`Angsuran ${formatCurr(angsuran)} melebihi batas region ${formatCurr(maxAngsuran)}`);
        } else if (status === 'eksisting') {
          const prev = parseNum(getVal('nk_angs_prev'));
          const maxAngsuran = Math.floor(prev * 1.5);
          if (prev > 0 && angsuran > maxAngsuran) addFail(`Angsuran ${formatCurr(angsuran)} melebihi 1,5x angsuran sebelumnya (${formatCurr(maxAngsuran)})`);
        }

        if (kbij === 'no') {
          const bdBucket = getVal('nk_kbij_bd');
          const dpd = getVal('nk_kbij_dpd');
          if (status === 'eksisting' && (rating === 'excellent' || rating === 'good')) {
            if (!(bdBucket === 'gt30' && dpd === 'gt60')) addFail('KBIJ No untuk eksisting Excellent/Good wajib BD > Rp 30 juta dan DPD > 60 hari');
          } else {
            if (dpd !== 'lte60') addFail('KBIJ No untuk konsumen baru/normal wajib DPD <= 60 hari');
          }
        }

        const eff = getMotorkuEffectiveMaxLTV();
        if (eff.maxLTV === null) addFail('Usia kendaraan maksimal 12 tahun');
        else if (ltv > eff.maxLTV) addFail(`LTV ${ltv}% melebihi maksimal ${eff.maxLTV}%`);

        if (pajak === 'mati') {
          if (region !== 'jatim_bnt') addFail('Pajak tahunan mati hanya diperbolehkan untuk region Jatim');
          else addNote('PEMBIAYAAN MOTORKU NORMAL KILAT DENGAN KONDISI PAJAK TAHUNAN MATI (APPROVAL S.D CAC)');
        }

        if (faktur === 'tidak') addNote('Tidak ada faktur: batas LTV turun 5%');
        if (getVal('nk_bpkb') === 'oranglain') addNote('BPKB atas nama orang lain wajib lampirkan kwitansi jual beli');
        if (usiaKonsumen < 21 || usiaKonsumen > 60) addNote('Usia konsumen di luar ketentuan standar dapat diajukan deviasi');
      } else if (currentProduct === 'newbike_bpjs') {
        const kbijPas = getVal('nk_kbij_pas');
        if (!['yes', 'notfound'].includes(kbijPas)) addFail('KBIJ pasangan/penjamin harus Yes atau Not Found');
        if (kbij === 'no') {
          const eligibleNo = status === 'eksisting' && (rating === 'excellent' || rating === 'good');
          if (!eligibleNo) {
            addFail('KBIJ No hanya diperbolehkan untuk konsumen terdaftar rating Excellent/Good');
          } else {
            const bdBucket = getVal('nk_kbij_bd');
            const dpd = getVal('nk_kbij_dpd');
            const slik = getVal('nk_kbij_slik');
            if (!(bdBucket === 'gt30' && dpd === 'gt60' && slik === 'ya')) {
              addFail('KBIJ No wajib BD > Rp 30 juta, DPD > 60 hari, dan cek SLIK');
            }
          }
        } else if (!['yes', 'notfound'].includes(kbij)) {
          addFail('KBIJ pemohon harus Yes/Not Found atau No sesuai ketentuan');
        }

        if (getVal('nk_dukcapil') !== 'match') addFail('Dukcapil wajib Match');
        if (getVal('nk_bpjs_status') !== 'terdaftar') addFail('Status BPJS wajib Terdaftar');
        if (getVal('nk_bpjs_income') !== 'ya') addFail('Validasi penghasilan JMO harus tervalidasi');
        if (getVal('nk_lama_kerja') !== '6bulan' && getVal('nk_lama_kerja') !== '1tahun') addFail('Lama kerja minimal 6 bulan');
        if (exp > 45000000) addFail('Total exposure melebihi Rp 45.000.000');
        if (tenor < 12 || tenor > 48) addFail('Tenor harus 12-48 bulan');
        if (iir > 45) addFail('IIR melebihi batas 45%');

        if (rumah === 'sewa') {
          if (parseNum(getVal('nk_lama_tinggal')) < 12) addFail('Domisili sewa minimal 12 bulan');
          if (dpPerc < 15) addFail('Domisili sewa wajib DP minimal 15%');
        } else if (dpPerc < 5) {
          addFail('DP minimal 5%');
        }
      } else if (currentProduct === 'newbike_nonbpjs') {
        const region = getVal('nk_region');
        const typeMotor = getVal('nk_type_motor');
        const kbijPas = getVal('nk_kbij_pas');

        if (!['yes', 'notfound'].includes(kbijPas)) addFail('KBIJ pasangan/penjamin harus Yes atau Not Found');
        if (kbij === 'no') {
          const eligibleNo = status === 'eksisting' && (rating === 'excellent' || rating === 'good');
          if (!eligibleNo) {
            addFail('KBIJ No hanya diperbolehkan untuk konsumen terdaftar rating Excellent/Good');
          } else {
            const bdBucket = getVal('nk_kbij_bd');
            const dpd = getVal('nk_kbij_dpd');
            const slik = getVal('nk_kbij_slik');
            if (!(bdBucket === 'gt30' && dpd === 'gt60' && slik === 'ya')) {
              addFail('KBIJ No wajib BD > Rp 30 juta, DPD > 60 hari, dan cek SLIK');
            }
          }
        } else if (!['yes', 'notfound'].includes(kbij)) {
          addFail('KBIJ pemohon harus Yes/Not Found atau No sesuai ketentuan');
        }

        if (exp > 45000000) addFail('Total exposure melebihi Rp 45.000.000');
        if (tenor < 12 || tenor > 48) addFail('Tenor harus 12-48 bulan');

        if (rumah === 'sewa') {
          if (parseNum(getVal('nk_lama_tinggal')) < 12) addFail('Domisili sewa minimal 12 bulan');
          if (dpPerc < 15) addFail('Domisili sewa wajib DP minimal 15%');
        } else {
          const minDP = status === 'eksisting' && (rating === 'excellent' || rating === 'good') ? 8 : 10;
          if (dpPerc < minDP) addFail(`DP minimal ${minDP}%`);
        }

        let maxIIR = getVal('nk_jenis_inc') === 'fixed' ? 30 : 25;
        if (region === 'jatengsel' || region === 'jatengut' || region === 'jabar') maxIIR += 5;
        if (iir > maxIIR) addFail(`IIR ${iir}% melebihi batas ${maxIIR}%`);

        if (status === 'baru') {
          const maxAngsuran = getNBNonBpjsMaxAngsuran(region, typeMotor);
          if (maxAngsuran && angsuran > maxAngsuran) addFail(`Angsuran ${formatCurr(angsuran)} melebihi batas region ${formatCurr(maxAngsuran)}`);
        } else if (status === 'eksisting') {
          const prev = parseNum(getVal('nk_angs_prev'));
          const maxAngsuran = Math.floor(prev * 1.5);
          if (prev > 0 && angsuran > maxAngsuran) addFail(`Angsuran ${formatCurr(angsuran)} melebihi 1,5x angsuran sebelumnya (${formatCurr(maxAngsuran)})`);
        }
      }

      renderNorkilComplianceResult(failReasons, notes, summaryItems);
    }

    /* ===== DEVIASI LOGIC ===== */
    const approvalHierarchy = ['CAC', 'CAM', 'CDH', 'CDDH', 'CADH', 'CRO', 'VPD', 'PD'];
    const approvalColors = {
      'CAC': 'app-cac', 'CAM': 'app-cam', 'CDH': 'app-cdh',
      'CDDH': 'app-cddh', 'CADH': 'app-cadh', 'CRO': 'app-cro', 'REJECT': 'app-reject'
    };

    function updateDeviasiUI() {
      $('dev_row_rating').classList.toggle('hidden', getVal('dev_status') !== 'terdaftar');
      $('dev_05_masku_wrap').classList.toggle('hidden', getVal('dev_prod') !== 'masku');
      const maxLTV = getDevMaxLTV(getVal('dev_prod'), getVal('dev_jenis_kend'), getVal('dev_kategori'));
      $('dev_max_ltv_display').textContent = maxLTV ? `${maxLTV}%` : '-';
    }

    function getDevMaxLTV(prod, jenis, kategori) {
      if (prod === 'mobilku') {
        if (jenis === 'passenger') {
          if (kategori === 'A') return 85;
          if (kategori === 'B') return 80;
          if (kategori === 'C') return 75;
        }
        if (jenis === 'commercial') {
          if (kategori === 'A') return 75;
          if (kategori === 'B') return 65;
        }
        return 65;
      }
      if (prod === 'motorku' || prod === 'hajiku' || prod === 'masku') return 85;
      return 0;
    }

    function getNegListBakiDebet(kol) {
      const bdTotal = parseNum(getVal('dev_bd_total'));
      if (kol !== 5) return bdTotal;

      const bdKol3 = parseNum(getVal('dev_bd_kol3'));
      const bdKol4 = parseNum(getVal('dev_bd_kol4'));
      const bdKol5 = parseNum(getVal('dev_bd_kol5'));
      const sumKol345 = bdKol3 + bdKol4 + bdKol5;
      return sumKol345 > 0 ? sumKol345 : bdTotal;
    }

    function getNegListDev(params) {
      const { kol, bd, prod, status, rating, ph, negType } = params;
      if (!kol || kol === 1) return null;

      if (negType === 'internal') {
        return { code: 'C010421(A/M)', desc: `Internal Negative List Kol ${kol}`, app: 'CDH' };
      }

      if (kol === 2 && prod === 'motorku' && status === 'terdaftar' && ['excellent', 'good', 'normal'].includes(rating) && ph < 50000000) {
        return null;
      }

      const mult = prod === 'mobilku' ? 1 : 0.5;
      if (kol === 5) {
        if (bd > 50000000 * mult) return { code: 'C010124(M)', desc: 'Eksternal Kol 5 BD > ' + formatCurr(50000000 * mult), app: 'CRO' };
        if (bd > 30000000 * mult) return { code: 'C010224(M)', desc: 'Eksternal Kol 5 BD 30-50 Jt', app: 'CADH' };
        if (bd > 5000000 * mult) return { code: 'C010424(M)', desc: 'Eksternal Kol 5 BD 5-30 Jt', app: 'CDDH' };
        if (bd > 1000000) return { code: 'C010724(M)', desc: 'Eksternal Kol 5 BD 1-5 Jt', app: 'CDH' };
        return { code: 'C010924(M)', desc: 'Eksternal Kol 5 BD <= 1 Jt', app: 'CAM' };
      }
      if (kol === 4) {
        if (bd > 50000000 * mult) return { code: 'C010324(M)', desc: 'Eksternal Kol 4 BD > 50 Jt', app: 'CADH' };
        return { code: 'C010524(M)', desc: 'Eksternal Kol 4 BD <= 50 Jt', app: 'CDDH' };
      }
      if (kol === 3) {
        if (bd > 50000000 * mult) return { code: 'C010624(M)', desc: 'Eksternal Kol 3 BD > 50 Jt', app: 'CDDH' };
        if (bd > 5000000) return { code: 'C011024(M)', desc: 'Eksternal Kol 3 BD 5-50 Jt', app: 'CAM' };
        return { code: 'C011224(M)', desc: 'Eksternal Kol 3 BD <= 5 Jt', app: 'CAC' };
      }
      if (kol === 2) {
        if (bd > 50000000 * mult) return { code: 'C010824(M)', desc: 'Eksternal Kol 2 BD > 50 Jt', app: 'CDH' };
        if (bd > 5000000) return { code: 'C011124(M)', desc: 'Eksternal Kol 2 BD 5-50 Jt', app: 'CAM' };
        return { code: 'C011324(M)', desc: 'Eksternal Kol 2 BD <= 5 Jt', app: 'CAC' };
      }
      return null;
    }

    function getNegListPrereqDevs(params) {
      const { kol, prod, ltv, dp, tenor, jenisKend, kategori } = params;
      const devs = [];
      if (!kol || kol < 3) return devs;

      if (prod === 'motorku' && ltv > 85) devs.push({ code: 'RULE-NL-MOTOR-LTV', desc: 'Kol 3/4/5 MotorKu: LTV wajib <= 85% (tidak boleh deviasi LTV)', app: 'REJECT' });
      if (prod === 'mobilku') {
        const maxMobilLTV = getDevMaxLTV(prod, jenisKend, kategori);
        if (maxMobilLTV > 0 && ltv > maxMobilLTV) devs.push({ code: 'RULE-NL-MOBIL-LTV', desc: `Kol 3/4/5 MobilKu: LTV melebihi ketentuan (${maxMobilLTV}%)`, app: 'REJECT' });
      }
      if (prod === 'nb' && dp > 0 && dp < 12.5) devs.push({ code: 'RULE-NL-NB-DP', desc: 'Kol 3/4/5 NB: DP minimal 12,5%', app: 'REJECT' });
      if (prod === 'masku' && dp > 0 && dp < 10) devs.push({ code: 'RULE-NL-MASKU-DP', desc: 'Kol 3/4/5 MasKu: DP minimal 10%', app: 'REJECT' });
      if (tenor > 48) devs.push({ code: 'RULE-NL-TENOR', desc: 'Semua produk: tenor tidak diperbolehkan deviasi', app: 'REJECT' });

      return devs;
    }

    function getMinIncomeThreshold(prod) {
      if (prod === 'mobilku') return 6500000;
      if (prod === 'motorku' || prod === 'masku' || prod === 'hajiku' || prod === 'nb') return 2500000;
      return 0;
    }

    function getDSRDev(dsr, prod) {
      if (dsr <= 0) return null;
      if (dsr > 80) return { code: 'RD653(M)', desc: 'DSR > 80% (wajib flag)', app: 'CDH' };

      if (prod === 'nb') {
        if (dsr > 55) return { code: 'C020122(A)', desc: 'DSR >55% s.d 80% (NB)', app: 'CAM' };
        if (dsr > 30) return { code: 'C020222(A)', desc: 'DSR >30% s.d 55% (NB)', app: 'CAC' };
      } else if (prod === 'mobilku') {
        if (dsr > 55) return { code: 'C020622(A)', desc: 'DSR >55% s.d 80% (MobilKu)', app: 'CAM' };
        if (dsr > 30) return { code: 'C020722(A)', desc: 'DSR >30% s.d 55% (MobilKu)', app: 'CAC' };
      } else {
        if (dsr > 65) return { code: 'C020422(A)', desc: 'DSR >65% s.d 80% (MotorKu/HajiKu/MasKu)', app: 'CAM' };
        if (dsr > 40) return { code: 'C020522(A)', desc: 'DSR >40% s.d 65% (MotorKu/HajiKu/MasKu)', app: 'CAC' };
      }
      return null;
    }

    function getUsiaDev(usia) {
      if (usia > 70) return { code: 'REJECT', desc: 'Usia > 70 Thn', app: 'REJECT' };
      if (usia > 60) return { code: 'C050221(A)', desc: 'Usia > 60 s.d 70 Thn', app: 'CAC' };
      if (usia < 21) return { code: 'C050721(A)', desc: 'Usia < 21 Thn', app: 'CAM' };
      return null;
    }

    function getTenorDev(tenor, prod, ltv, usiaKend) {
      if (tenor <= 48) return null;
      if (prod === 'mobilku' && tenor <= 60) {
        if (ltv > 85) return { code: 'RULE-TENOR-LTV', desc: 'Tenor Mobil >48-60 hanya jika LTV <= 85%', app: 'REJECT' };
        if (usiaKend > 10) return { code: 'RULE-TENOR-USIA', desc: 'Tenor Mobil >48-60 hanya jika usia kendaraan <= 10 tahun', app: 'REJECT' };
        return { code: 'C030124(M)', desc: 'Tenor >48 s.d 60 bulan (MobilKu)', app: 'CAC', note: 'Maks LTV 85% & usia kendaraan <=10 tahun' };
      }
      return { code: 'RULE-TENOR-NODEV', desc: 'Tenor tidak diperbolehkan deviasi untuk produk ini', app: 'REJECT' };
    }

    function getLTVDev(ltv, maxLTV, prod) {
      if (ltv <= 0 || maxLTV <= 0) return null;
      if (prod === 'mobilku') {
        if (ltv > 90) return { code: 'RULE-LTV-MOBIL', desc: 'LTV MobilKu > 90% tidak dapat dibiayai', app: 'REJECT' };
        const gap = ltv - maxLTV;
        if (gap > 10) return { code: 'C030921(M)', desc: `LTV naik >10% dari ketentuan (${maxLTV}%)`, app: 'CAM' };
        if (gap > 0) return { code: 'C030821(M)', desc: `LTV naik s.d 10% dari ketentuan (${maxLTV}%)`, app: 'CAC' };
        return null;
      }

      if (prod === 'motorku' || prod === 'hajiku' || prod === 'masku') {
        if (ltv > 95) return { code: 'RULE-LTV-MOTOR', desc: 'LTV MotorKu/HajiKu/MasKu > 95% tidak dapat dibiayai', app: 'REJECT' };
        const gap = ltv - maxLTV;
        if (gap > 10) return { code: 'C030222(M)', desc: `LTV naik >10% dari ketentuan (${maxLTV}%)`, app: 'CAM' };
        if (gap > 0) return { code: 'C030122(M)', desc: `LTV naik s.d 10% dari ketentuan (${maxLTV}%)`, app: 'CAC' };
      }
      return null;
    }

    function getTODev(to) {
      if (to === 'current') return { code: 'C030123(M)', desc: 'Take Over Fincoy Current', app: 'CAC', note: 'Historikal < 9 bln' };
      if (to === 'tidakcurrent') return { code: 'C031121(M)', desc: 'Take Over Fincoy Tidak Current', app: 'CAM', note: 'Historikal < 9 bln' };
      return null;
    }

    function checkDeviasi() {
      const prod = getVal('dev_prod');
      const status = getVal('dev_status');
      const rating = getVal('dev_rating');
      const ph = parseNum(getVal('dev_ph'));
      const isTopup = getVal('dev_is_topup') === 'ya';
      const bpkbOwner = getVal('dev_bpkb_owner');
      const jenisKend = getVal('dev_jenis_kend');
      const kategori = getVal('dev_kategori');
      let deviasiList = [];
      let groupCount = new Set();
      let hasReject = false;
      const addDev = (groupNo, groupLabel, dev) => {
        if (!dev) return;
        groupCount.add(groupNo);
        dev.group = `${groupNo} - ${groupLabel}`;
        deviasiList.push(dev);
        if (dev.app === 'REJECT') hasReject = true;
      };

      // 01 - Negative List
      const kol = parseInt(getVal('dev_kol'), 10) || 1;
      const bd = getNegListBakiDebet(kol);
      const negType = getVal('dev_neg_type');
      const ltv = parseDecimal(getVal('dev_ltv'));
      const dp = parseDecimal(getVal('dev_dp'));
      const tenor = parseNum(getVal('dev_tenor'));
      const negDev = getNegListDev({ kol, bd, prod, status, rating, ph, negType });
      addDev('01', 'Negative List', negDev);
      const negPrereqs = getNegListPrereqDevs({ kol, prod, ltv, dp, tenor, jenisKend, kategori });
      negPrereqs.forEach(dev => addDev('01', 'Negative List', dev));

      // 02 - DSR & Min Penghasilan
      const dsr = parseDecimal(getVal('dev_dsr'));
      if (dsr > 0) {
        const dsrDev = getDSRDev(dsr, prod);
        addDev('02', 'DSR & Min Penghasilan', dsrDev);
      }
      const income = parseNum(getVal('dev_income'));
      const minIncome = getMinIncomeThreshold(prod);
      if (income > 0 && minIncome > 0 && income < minIncome) {
        addDev('02', 'DSR & Min Penghasilan', { code: 'C020421(A)', desc: `Penghasilan minimum diluar ketentuan (< ${formatCurr(minIncome)})`, app: 'CAC' });
      }

      // 03 - Skema Produk
      const usiaKend = parseNum(getVal('dev_usia_kend'));
      const maxLTV = getDevMaxLTV(prod, jenisKend, kategori);
      if (tenor > 0) {
        addDev('03', 'Skema Produk', getTenorDev(tenor, prod, ltv, usiaKend));
      }
      if (ltv > 0) addDev('03', 'Skema Produk', getLTVDev(ltv, maxLTV, prod));
      const to = getVal('dev_to');
      if (to) addDev('03', 'Skema Produk', getTODev(to));

      // 04 - Unit Pembiayaan
      if ($('dev_04_faktur').checked && !isTopup) addDev('04', 'Unit Pembiayaan', { code: 'C040321(M)', desc: 'Faktur Tidak Ada', app: 'CAC' });
      if ($('dev_04_unit').checked) addDev('04', 'Unit Pembiayaan', { code: 'C040621(A/M)', desc: 'Unit Diluar Ketentuan', app: 'CAM' });
      if ($('dev_04_kir').checked) {
        if (prod === 'mobilku' && jenisKend === 'passenger') addDev('04', 'Unit Pembiayaan', { code: 'C040821(M)', desc: 'KIR Tidak Aktif', app: 'CAC' });
        else addDev('04', 'Unit Pembiayaan', { code: 'RULE-KIR', desc: 'KIR hanya berlaku untuk MobilKu Passenger', app: 'REJECT' });
      }
      if ($('dev_04_plat').checked) addDev('04', 'Unit Pembiayaan', { code: 'RD585(M)', desc: 'Plat Beda Provinsi', app: 'CAC', note: 'Wajib BBN atau LTV turun 5%' });
      if ($('dev_04_agunan_beda').checked) addDev('04', 'Unit Pembiayaan', { code: 'C041021(M)', desc: 'Agunan Berbeda dengan BPKB (Modif)', app: 'CAC' });
      if ($('dev_04_kwitansi').checked) addDev('04', 'Unit Pembiayaan', { code: 'C041221(M)', desc: 'Kwitansi Jual Beli Tidak Ada', app: 'CAC' });
      if ($('dev_04_luar_kota').checked) {
        if (prod === 'mobilku') addDev('04', 'Unit Pembiayaan', { code: 'C040123(M)', desc: 'Foto Kendaraan di Luar Kota (Mobil)', app: 'CAM' });
        else addDev('04', 'Unit Pembiayaan', { code: 'C040222(M)', desc: 'Foto Kendaraan di Luar Kota (Motor/NB)', app: 'CAC' });
      }
      if ($('dev_04_unit_motor').checked && (prod === 'motorku' || prod === 'nb')) addDev('04', 'Unit Pembiayaan', { code: 'C040621(A/M)', desc: 'Maks Unit Motor Diluar Ketentuan', app: 'CAM' });
      if (bpkbOwner === 'oranglain' && !$('dev_04_kwitansi').checked) addDev('04', 'Unit Pembiayaan', { code: 'C041221(M)', desc: 'BPKB a.n orang lain wajib kwitansi jual beli', app: 'CAC' });

      // 05 - Profil Konsumen
      const usia = parseNum(getVal('dev_usia'));
      if (usia > 0) {
        const dev = getUsiaDev(usia);
        addDev('05', 'Profil Konsumen', dev);
      }
      if ($('dev_05_sensitive').checked) {
        const note = status === 'terdaftar' ? 'Konsumen terdaftar tidak wajib rekomendasi collection' : 'Wajib rekomendasi collection';
        addDev('05', 'Profil Konsumen', { code: 'C050421(M)', desc: 'Sensitive Employee / PEP', app: 'CAM', note });
      }
      if ($('dev_05_lamakerja').checked) addDev('05', 'Profil Konsumen', { code: 'C050521(M)', desc: 'Lama bekerja/usaha diluar ketentuan', app: 'CAC' });
      if ($('dev_05_ao').checked) addDev('05', 'Profil Konsumen', { code: 'C050621(A)', desc: 'Periode AO/Top Up < 6 bulan', app: 'CAC' });
      if ($('dev_05_telp').checked) addDev('05', 'Profil Konsumen', { code: 'C050821(M)', desc: 'No telepon rumah kontrak tidak ada', app: 'CAC' });
      if ($('dev_05_sewa').checked) addDev('05', 'Profil Konsumen', { code: 'C050921(M)', desc: 'Lama kontrak/sewa < 1 tahun', app: 'CAC' });
      if ($('dev_05_to_od30').checked && (prod === 'mobilku' || prod === 'motorku')) addDev('05', 'Profil Konsumen', { code: 'RD591(M)', desc: 'Take Over OD s.d 30 hari non restrukturisasi', app: 'CAC' });
      if (prod === 'masku' && $('dev_05_masku_risk').checked) addDev('05', 'Profil Konsumen', { code: 'LM050221(M)', desc: 'Profil/Usaha Konsumen berisiko tinggi (MasKu)', app: 'CAM' });

      // 06 - Cover Area & Red Area
      if ($('dev_06_red').checked && status !== 'terdaftar') addDev('06', 'Cover Area & Red Area', { code: 'C060121(M)', desc: 'Red Area', app: 'CAM', note: 'Wajib rekomendasi collection' });
      if ($('dev_06_cover').checked) addDev('06', 'Cover Area & Red Area', { code: 'C060221(M)', desc: 'Cover Area tidak sesuai ketentuan', app: 'CAM' });

      // 07 - Dokumen Pembiayaan
      if ($('dev_07_npwp').checked) addDev('07', 'Dokumen Pembiayaan', { code: 'C070121(A)', desc: 'NPWP Tidak Sesuai', app: 'CAC', note: 'Pengajuan > 50 Juta' });
      if ($('dev_07_keuangan').checked) addDev('07', 'Dokumen Pembiayaan', { code: 'C070221', desc: 'Dokumen data keuangan/usaha tidak sesuai ketentuan', app: 'CAC' });
      if ($('dev_07_mandatory').checked) addDev('07', 'Dokumen Pembiayaan', { code: 'C070322S1', desc: 'Dokumen mandatory diluar ketentuan', app: 'CAC' });
      if ($('dev_07_cabanglain').checked) addDev('07', 'Dokumen Pembiayaan', { code: 'C070721(M)', desc: 'Konsumen menandatangani pembiayaan di cabang lain', app: 'CAC' });
      if ($('dev_07_jandaduda').checked) addDev('07', 'Dokumen Pembiayaan', { code: 'RD615S1', desc: 'Deviasi dokumen pembiayaan (Janda/Duda)', app: 'CAC' });
      if ($('dev_07_ttd').checked) {
        if (prod === 'mobilku') addDev('07', 'Dokumen Pembiayaan', { code: 'RD568S2', desc: 'Pasangan tidak bisa e-sign (Mobil)', app: 'CAM' });
        else addDev('07', 'Dokumen Pembiayaan', { code: 'RD567(A)', desc: 'Pasangan tidak bisa e-sign (Motor/NB/MasKu)', app: 'CAC' });
      }
      if ($('dev_07_dukcapil_blank').checked && status === 'baru') addDev('07', 'Dokumen Pembiayaan', { code: 'C070122S1', desc: 'Dukcapil tidak ada / blank (konsumen baru)', app: 'CAC' });
      const fatal = getVal('dev_07_fatal');
      if (fatal === 'sesuai') addDev('07', 'Dokumen Pembiayaan', { code: 'C070123S1', desc: 'Fatal score sesuai hasil validasi', app: 'CAC' });
      if (fatal === 'tidaksesuai') addDev('07', 'Dokumen Pembiayaan', { code: 'C070123S2', desc: 'Fatal score tidak sesuai hasil validasi', app: 'CAM' });

      renderDeviasiResult(deviasiList, groupCount, hasReject);
    }

    function renderDeviasiResult(deviasiList, groupCount, hasReject) {
      const container = $('res-deviasi');
      if (deviasiList.length === 0) {
        container.innerHTML = `<div class="status-badge status-pass justify-center text-sm w-full">Tidak Ada Deviasi Terdeteksi</div><div class="text-center text-[var(--text-muted)] text-sm mt-6"><svg class="w-16 h-16 mx-auto mb-3 text-[var(--accent-emerald)]" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Aplikasi sesuai ketentuan tanpa penyimpangan.</div>`;
        return;
      }

      let highestApp = 'CAC';
      deviasiList.forEach(dev => { if (dev.app !== 'REJECT' && approvalHierarchy.indexOf(dev.app) > approvalHierarchy.indexOf(highestApp)) highestApp = dev.app; });

      const grouped = {};
      deviasiList.forEach(dev => { if (!grouped[dev.group]) grouped[dev.group] = []; grouped[dev.group].push(dev); });

      let html = '';
      const statusClass = hasReject ? 'status-fail' : 'status-warn';
      const statusText = hasReject ? 'DITEMUKAN REJECT' : 'DITEMUKAN DEVIASI';
      html += `<div class="status-badge ${statusClass} justify-center text-sm w-full">${hasReject ? 'X' : '!'} ${statusText}</div>`;
      
      html += `<div class="info-box mb-4"><div class="text-xs text-[var(--accent-primary)] font-bold mb-2">RINGKASAN</div><div class="grid grid-cols-2 gap-2 text-xs"><div><span class="text-[var(--text-muted)]">Total Deviasi:</span> <span class="font-bold text-[var(--text-primary)]">${deviasiList.length}</span></div><div><span class="text-[var(--text-muted)]">Group Terlibat:</span> <span class="font-bold text-[var(--text-primary)]">${groupCount.size}/7</span></div></div>${groupCount.size > 3 ? '<div class="mt-2 text-xs text-[var(--accent-coral)] font-bold">Peringatan: Lebih dari 3 Group Deviasi! Wajib IM Paper.</div>' : ''}</div>`;

      for (const group in grouped) {
        const hasRejectInGroup = grouped[group].some(d => d.app === 'REJECT');
        html += `<div class="result-group"><div class="result-header ${hasRejectInGroup ? 'invalid' : 'warn'}"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>${group}</div><div class="result-body">`;
        grouped[group].forEach(dev => {
          const appClass = approvalColors[dev.app] || 'app-cac';
          html += `<div class="result-row"><div class="flex-1"><div class="font-bold text-[var(--accent-primary)]">${dev.code}</div><div class="text-[var(--text-secondary)]">${dev.desc}</div>${dev.note ? `<span class="dev-note">${dev.note}</span>` : ''}</div><div><span class="dev-approval-badge ${appClass}">${dev.app}</span></div></div>`;
        });
        html += `</div></div>`;
      }

      if (!hasReject) {
        html += `<div class="final-approval-box"><div class="text-xs opacity-80">APPROVAL FINAL</div><div class="final-approval-level">${highestApp}</div><div class="final-approval-note">Berdasarkan wewenang tertinggi dari deviasi yang terdeteksi</div></div>`;
      } else {
        html += `<div class="bg-[rgba(244,63,94,0.08)] border border-[rgba(244,63,94,0.2)] rounded-lg p-4 text-center mt-4"><div class="text-[var(--accent-coral)] font-bold">TIDAK DAPAT DIPROSES</div><div class="text-xs text-[var(--accent-coral)] opacity-80">Ditemukan kondisi REJECT</div></div>`;
      }
      container.innerHTML = html;
    }

    /* ===== SUPER ===== */
    let superType = 'ro';
    
    function renderSuperDokumen() {
      const container = $('doc_super_container');
      const docs = [
        { id: 'sp_doc_ktp', label: 'E-KTP', mandatory: true },
        { id: 'sp_doc_kk', label: 'KK', mandatory: true },
        { id: 'sp_doc_rumah', label: 'Bukti Kepemilikan Rumah', mandatory: superType === 'nc' },
        { id: 'sp_doc_income', label: 'Bukti Penghasilan', mandatory: superType === 'nc' },
        { id: 'sp_doc_npwp', label: 'NPWP (> 50 Juta)', mandatory: false }
      ];
      container.innerHTML = docs.map(doc => `
        <label class="custom-check">
          <input type="checkbox" id="${doc.id}">
          <div><span class="font-semibold text-[var(--text-primary)]">${doc.label}</span>${doc.mandatory ? '<span class="text-[var(--accent-coral)] text-xs ml-1">*</span>' : ''}</div>
        </label>
      `).join('');
    }

    function setSuperType(t) {
      superType = t;
      $('super-ro').className = "super-tab"; $('super-to').className = "super-tab"; $('super-nc').className = "super-tab";
      $(t === 'ro' ? 'super-ro' : (t === 'to' ? 'super-to' : 'super-nc')).className = "super-tab active";
      $('row_to_specific').classList.toggle('hidden', t !== 'to');
      $('row_nc_specific').classList.toggle('hidden', t !== 'nc');
      $('sp_row_jenis_kons').classList.toggle('hidden', t !== 'to');
      $('sp_row_rating_super').classList.toggle('hidden', t !== 'ro');
      $('sp_row_usia_super').classList.toggle('hidden', t === 'to');
      renderSuperDokumen();
      updateSuperUI();
    }

    function updateSuperUI() {
      const jenis = getVal('sp_jenis');
      const maxIIR = superType === 'ro' ? 40 : 30;
      $('sp_iir_note').textContent = `Max: ${maxIIR}% (${superType.toUpperCase()})`;
      const maxLTV = jenis === 'commercial' ? 85 : 90;
      $('sp_ltv_note').textContent = `Max: ${maxLTV}%`;
      let maxUsia = 10;
      if (superType === 'ro' && jenis === 'passenger') maxUsia = 17;
      $('sp_usia_note').textContent = `Max: ${maxUsia} tahun (${superType.toUpperCase()}${jenis === 'passenger' ? ' Passenger' : ''})`;
    }

    function validateSuperInputs() {
      const missing = [];
      const commonFields = [
        { id: 'sp_kerja', label: 'Jenis Pekerjaan' },
        { id: 'sp_rumah', label: 'Status Rumah' },
        { id: 'sp_kbij', label: 'KBIJ Pemohon' },
        { id: 'sp_internal', label: 'Internal Neg List' },
        { id: 'sp_tbwo', label: 'Riwayat TB/WO' },
        { id: 'sp_iir', label: 'IIR' },
        { id: 'sp_ltv', label: 'LTV' },
        { id: 'sp_tenor', label: 'Tenor' },
        { id: 'sp_exp', label: 'Total Exposure' },
        { id: 'sp_jenis', label: 'Jenis Kendaraan' },
        { id: 'sp_usia_kend', label: 'Usia Kendaraan' },
        { id: 'sp_bpkb', label: 'Kepemilikan BPKB' },
        { id: 'sp_stnk', label: 'Status STNK' }
      ];

      commonFields.forEach(f => { if (!getVal(f.id)) missing.push(f.label); });

      if (superType !== 'to' && !getVal('sp_usia')) missing.push('Usia Pemohon');
      if (superType === 'ro' && !getVal('sp_rating')) missing.push('Rating Konsumen');
      if (superType === 'to') {
        if (!getVal('sp_jenis_kons')) missing.push('Jenis Konsumen');
        if (!getVal('sp_to_kategori')) missing.push('Kategori Kendaraan');
        if (!getVal('sp_to_bayar')) missing.push('Angsuran Dibayar');
        if (!getVal('sp_to_od')) missing.push('Maksimal Overdue');
      }

      return missing;
    }

    function checkSuper() {
      const missing = validateSuperInputs();
      if (missing.length > 0) {
        renderEmptyResult('res-super', 'Form Belum Lengkap', missing);
        return;
      }

      let results = { categories: {}, overall: 'pass' };
      const addResult = (cat, t, m) => {
        if (!results.categories[cat]) results.categories[cat] = [];
        results.categories[cat].push({ t, m });
        if (t === 'fail') results.overall = 'fail';
        else if (t === 'warn' && results.overall !== 'fail') results.overall = 'warn';
      };

      const rating = getVal('sp_rating'), exp = parseNum(getVal('sp_exp')), usia = parseNum(getVal('sp_usia')), usiaKend = parseNum(getVal('sp_usia_kend')), iir = parseNum(getVal('sp_iir')), tenor = parseNum(getVal('sp_tenor')), jenisKend = getVal('sp_jenis');
      const ltv = parseNum(getVal('sp_ltv'));

      const docs = [
        { id: 'sp_doc_ktp', label: 'E-KTP', mandatory: true },
        { id: 'sp_doc_kk', label: 'KK', mandatory: true },
        { id: 'sp_doc_rumah', label: 'Bukti Kepemilikan Rumah', mandatory: superType === 'nc' },
        { id: 'sp_doc_income', label: 'Bukti Penghasilan', mandatory: superType === 'nc' }
      ];
      const missingDocs = docs.filter(d => d.mandatory && !$(d.id).checked);
      if (missingDocs.length > 0) addResult('Dokumen', 'fail', 'Tidak lengkap: ' + missingDocs.map(d => d.label).join(', '));
      else addResult('Dokumen', 'pass', `Dokumen ${superType === 'nc' ? 'lengkap (Normal Doc)' : 'lengkap (Simple Doc)'}`);

      if (superType === 'ro' && (rating === 'warning' || rating === 'bad')) addResult('Negative List', 'fail', `Rating ${rating} tidak dibiayai RO Super`);
      else addResult('Negative List', 'pass', 'Rating sesuai');
      if (getVal('sp_internal') === 'ya') addResult('Negative List', 'fail', 'Internal Negative List');
      else addResult('Negative List', 'pass', 'Tidak termasuk Internal Neg List');
      if (getVal('sp_tbwo') === 'ya') addResult('Negative List', 'fail', 'Riwayat TB/WO');
      else addResult('Negative List', 'pass', 'Tidak ada riwayat TB/WO');
      if (getVal('sp_kbij') === 'no') addResult('Negative List', 'fail', 'KBIJ No tidak diperbolehkan');
      else addResult('Negative List', 'pass', 'KBIJ sesuai');

      if (superType !== 'to') {
        if (usia > 60) addResult('Data Konsumen', 'fail', `Usia ${usia} > Max 60 Thn`);
        else addResult('Data Konsumen', 'pass', `Usia ${usia} thn sesuai`);
      }
      if (getVal('sp_rumah') === 'sewa') addResult('Data Konsumen', 'fail', 'Tidak boleh sewa');
      else addResult('Data Konsumen', 'pass', 'Status rumah sesuai');

      if (exp > 250000000) addResult('Keuangan', 'fail', `Exposure ${formatCurr(exp)} > 250 Jt`);
      else addResult('Keuangan', 'pass', `Exposure ${formatCurr(exp)} sesuai`);
      
      const maxIIR = superType === 'ro' ? 40 : 30;
      if (iir > maxIIR) addResult('Keuangan', 'fail', `IIR ${iir}% > Max ${maxIIR}% (${superType.toUpperCase()})`);
      else addResult('Keuangan', 'pass', `IIR ${iir}% sesuai`);

      const maxLTV = jenisKend === 'passenger' ? 90 : 85;
      if (ltv > maxLTV) addResult('Keuangan', 'fail', `LTV ${ltv}% > Max ${maxLTV}% (${jenisKend})`);
      else addResult('Keuangan', 'pass', `LTV ${ltv}% sesuai`);

      if (tenor > 48) addResult('Keuangan', 'warn', 'Tenor > 48 = Deviasi');
      else addResult('Keuangan', 'pass', `Tenor ${tenor} bulan`);

      let maxAge = 10;
      if (superType === 'ro' && jenisKend === 'passenger') maxAge = 17;
      if (usiaKend > maxAge) addResult('Kendaraan', 'fail', `Usia kendaraan ${usiaKend} > ${maxAge} thn`);
      else addResult('Kendaraan', 'pass', `Usia kendaraan ${usiaKend} thn sesuai`);

      if (getVal('sp_stnk') === 'mati') addResult('Kendaraan', 'warn', 'STNK Mati: Wajib perpanjangan');
      else addResult('Kendaraan', 'pass', 'STNK hidup');
      if (getVal('sp_bpkb') === 'oranglain') addResult('Kendaraan', 'warn', 'BPKB Orang Lain: Wajib BBN');
      else addResult('Kendaraan', 'pass', 'BPKB sendiri/pasangan');

      if (superType === 'to') {
        const jenisKons = getVal('sp_jenis_kons');
        const kategoriKend = getVal('sp_to_kategori');
        if (jenisKend !== 'passenger') addResult('Take Over', 'fail', 'Hanya jenis kendaraan Passenger yang dapat dibiayai');
        else addResult('Take Over', 'pass', 'Jenis kendaraan Passenger sesuai');
        if (kategoriKend !== 'A') addResult('Take Over', 'fail', 'Hanya kategori kendaraan A yang dapat dibiayai');
        else addResult('Take Over', 'pass', 'Kategori kendaraan A sesuai');
        if (jenisKons === 'baru') addResult('Take Over', 'fail', 'Konsumen Baru tidak diperbolehkan');
        else addResult('Take Over', 'pass', 'Konsumen Terdaftar');
        if (parseNum(getVal('sp_to_bayar')) < 12) addResult('Take Over', 'fail', 'Min 12 bln pembayaran');
        else addResult('Take Over', 'pass', 'Angsuran dibayar sesuai');
        if (getVal('sp_to_od') !== 'kurang') addResult('Take Over', 'warn', 'Overdue > 14 hari = Deviasi');
        else addResult('Take Over', 'pass', 'Overdue < 14 hari');
        const appLevel = exp > 75000000 ? 'CMG' : 'CAC';
        addResult('Take Over', 'warn', `<strong>Approval Level: ${appLevel}</strong>`);
      }

      if (superType === 'nc') {
        addResult('NC Super', 'pass', 'Approval final di CAC');
      }

      if (superType === 'ro') addResult('RO Super', 'pass', 'Approval final di CAC');

      const superSummary = {
        type: superType,
        rating,
        usia,
        usiaKend,
        iir,
        ltv,
        tenor,
        exp,
        jenisKend,
        rumah: getVal('sp_rumah'),
        bpkb: getVal('sp_bpkb'),
        stnk: getVal('sp_stnk'),
        jenisKons: getVal('sp_jenis_kons'),
        toKategori: getVal('sp_to_kategori'),
        toBayar: parseNum(getVal('sp_to_bayar')),
        toOd: getVal('sp_to_od')
      };

      renderSuperComplianceResult(results, superSummary);
    }

    function renderSuperComplianceResult(results, summary) {
      const container = $('res-super');
      const failReasons = [];
      const warnReasons = [];

      Object.keys(results.categories).forEach(cat => {
        results.categories[cat].forEach(item => {
          const plainText = item.m.replace(/<[^>]*>/g, '');
          if (item.t === 'fail') {
            failReasons.push(`${cat}: ${plainText}`);
          } else if (item.t === 'warn') {
            warnReasons.push(`${cat}: ${plainText}`);
          }
        });
      });

      const uniqueFailReasons = [...new Set(failReasons)];
      const uniqueWarnReasons = [...new Set(warnReasons)];

      const typeLabels = { ro: 'RO Super', to: 'Take Over Super', nc: 'NC Super' };
      const rumahLabels = { sendiri: 'Milik Sendiri/Keluarga', sewa: 'Sewa/Kontrak/Kost' };
      const bpkbLabels = { sendiri: 'Sendiri/Pasangan', oranglain: 'Orang Lain' };
      const stnkLabels = { hidup: 'Hidup', mati: 'Mati' };
      const odLabels = { kurang: '< 14 Hari', lebih: '> 14 Hari' };
      const jenisLabels = { passenger: 'Passenger', commercial: 'Commercial' };
      const ratingLabels = { excellent: 'Excellent', good: 'Good', normal: 'Normal', warning: 'Warning', bad: 'Bad' };
      const konsLabels = { baru: 'Konsumen Baru', terdaftar: 'Konsumen Terdaftar' };
      const analyzedAt = new Date().toLocaleString('id-ID', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });

      const summaryItems = [
        { label: 'Skema Super', value: typeLabels[summary.type] || summary.type },
        { label: 'Jenis Kendaraan', value: jenisLabels[summary.jenisKend] || '-' },
        { label: 'Total Exposure', value: summary.exp > 0 ? formatCurr(summary.exp) : '-' },
        { label: 'LTV', value: summary.ltv > 0 ? `${summary.ltv}%` : '-' },
        { label: 'IIR', value: summary.iir > 0 ? `${summary.iir}%` : '-' },
        { label: 'Tenor', value: summary.tenor > 0 ? `${summary.tenor} bulan` : '-' },
        { label: 'Usia Kendaraan', value: summary.usiaKend > 0 ? `${summary.usiaKend} tahun` : '-' },
        { label: 'Status Rumah', value: rumahLabels[summary.rumah] || '-' },
        { label: 'BPKB', value: bpkbLabels[summary.bpkb] || '-' },
        { label: 'Status STNK', value: stnkLabels[summary.stnk] || '-' }
      ];

      if (summary.type !== 'to') summaryItems.push({ label: 'Usia Pemohon', value: summary.usia > 0 ? `${summary.usia} tahun` : '-' });
      if (summary.type === 'ro') summaryItems.push({ label: 'Rating', value: ratingLabels[summary.rating] || '-' });
      if (summary.type === 'to') {
        summaryItems.push({ label: 'Jenis Konsumen', value: konsLabels[summary.jenisKons] || '-' });
        summaryItems.push({ label: 'Kategori Kendaraan', value: summary.toKategori || '-' });
        summaryItems.push({ label: 'Angsuran Dibayar', value: summary.toBayar > 0 ? `${summary.toBayar} bulan` : '-' });
        summaryItems.push({ label: 'Overdue', value: odLabels[summary.toOd] || '-' });
      }

      const statusClass = uniqueFailReasons.length > 0 ? 'status-fail' : 'status-pass';
      const statusText = uniqueFailReasons.length > 0 ? 'TIDAK LAYAK' : 'SESUAI DENGAN SK SUPER MOBILKU YANG BERLAKU';

      let html = '<div class="space-y-4">';
      html += `<div class="status-badge ${statusClass} justify-center text-sm w-full">${statusText}</div>`;

      html += '<div class="info-box">';
      html += '<div class="text-xs text-[var(--accent-primary)] font-bold mb-2">RINGKASAN HASIL</div>';
      html += '<div class="grid grid-cols-1 sm:grid-cols-4 gap-2 text-xs">';
      html += `<div><span class="text-[var(--text-muted)]">Kategori Dicek:</span><div class="font-bold text-[var(--text-primary)]">${Object.keys(results.categories).length}</div></div>`;
      html += `<div><span class="text-[var(--text-muted)]">Poin Tidak Sesuai:</span><div class="font-bold text-[var(--accent-coral)]">${uniqueFailReasons.length}</div></div>`;
      html += `<div><span class="text-[var(--text-muted)]">Catatan:</span><div class="font-bold text-[var(--accent-gold)]">${uniqueWarnReasons.length}</div></div>`;
      html += `<div><span class="text-[var(--text-muted)]">Waktu Analisa:</span><div class="font-bold text-[var(--text-primary)]">${analyzedAt}</div></div>`;
      html += '</div></div>';

      html += '<div class="result-group">';
      html += '<div class="result-header valid">Data Pengajuan Super</div>';
      html += '<div class="result-body"><div class="grid grid-cols-1 sm:grid-cols-2 gap-2">';
      summaryItems.forEach(item => {
        html += '<div class="rounded-lg border border-[rgba(148,163,184,0.12)] bg-[rgba(255,255,255,0.85)] p-3">';
        html += `<div class="text-[11px] text-[var(--text-muted)]">${item.label}</div>`;
        html += `<div class="text-xs font-semibold text-[var(--text-primary)] mt-1">${item.value}</div>`;
        html += '</div>';
      });
      html += '</div></div></div>';

      if (uniqueFailReasons.length > 0) {
        html += '<div class="result-group">';
        html += '<div class="result-header invalid">TIDAK LAYAK KARENA:</div>';
        html += '<div class="result-body"><ol class="text-xs text-[var(--text-secondary)] space-y-2 list-decimal list-inside">';
        uniqueFailReasons.forEach(reason => { html += `<li class="marker:text-[var(--accent-coral)]">${reason}</li>`; });
        html += '</ol></div></div>';
      }

      if (uniqueWarnReasons.length > 0) {
        html += '<div class="result-group">';
        html += '<div class="result-header warn">Catatan / Action Item</div>';
        html += '<div class="result-body"><ul class="text-xs text-[var(--text-secondary)] space-y-1">';
        uniqueWarnReasons.forEach(reason => { html += `<li>- ${reason}</li>`; });
        html += '</ul></div></div>';
      }

      const catOrder = ['Dokumen', 'Negative List', 'Data Konsumen', 'Keuangan', 'Kendaraan', 'Take Over', 'NC Super', 'RO Super'];
      const sortedCats = Object.keys(results.categories).sort((a, b) => catOrder.indexOf(a) - catOrder.indexOf(b));
      sortedCats.forEach(cat => {
        const items = results.categories[cat];
        const hasFail = items.some(i => i.t === 'fail');
        const hasWarn = items.some(i => i.t === 'warn');
        const headerClass = hasFail ? 'invalid' : (hasWarn ? 'warn' : 'valid');
        html += `<div class="result-group"><div class="result-header ${headerClass}">${cat}</div><div class="result-body">`;
        items.forEach(item => {
          const msg = item.m.replace(/<[^>]*>/g, '');
          html += `<div class="result-row"><div class="res-icon ${item.t === 'pass' ? 'pass' : (item.t === 'fail' ? 'fail' : 'warn')}">${item.t === 'pass' ? 'OK' : (item.t === 'fail' ? 'X' : '!')}</div><div class="res-text">${msg}</div></div>`;
        });
        html += '</div></div>';
      });

      html += '</div>';
      container.innerHTML = html;
    }

    /* ===== RENDER FUNCTIONS ===== */
    function renderEmptyResult(containerId, title, items) {
      const container = $(containerId);
      let html = `<div class="status-badge status-fail justify-center text-sm w-full">X ${title}</div>`;
      html += '<div class="bg-[rgba(244,63,94,0.05)] border border-[rgba(244,63,94,0.15)] rounded-lg p-4 mt-4">';
      html += '<div class="text-xs text-[var(--accent-coral)] font-bold mb-2">Field berikut wajib diisi:</div>';
      html += '<ul class="text-xs text-[var(--accent-coral)] space-y-1">';
      items.forEach(item => html += `<li>- ${item}</li>`);
      html += '</ul></div>';
      container.innerHTML = html;
    }

    function renderOrganizedResult(containerId, results, title) {
      const container = $(containerId);
      const overall = results.overall;
      const statusClass = overall === 'pass' ? 'status-pass' : (overall === 'fail' ? 'status-fail' : 'status-warn');
      const statusText = overall === 'pass' ? 'LAYAK KREDIT' : (overall === 'fail' ? 'TIDAK LAYAK' : 'LAYAK DENGAN CATATAN');
      const statusIcon = overall === 'pass' ? 'OK' : (overall === 'fail' ? 'X' : '!');

      let html = `<div class="status-badge ${statusClass} justify-center text-sm w-full">${statusIcon} ${statusText}</div>`;
      
      const catOrder = ['Dokumen', 'Negative List', 'Data Konsumen', 'Keuangan', 'Kendaraan', 'BPJS', 'Take Over', 'NC Super', 'RO Super'];
      const sortedCats = Object.keys(results.categories).sort((a, b) => catOrder.indexOf(a) - catOrder.indexOf(b));

      sortedCats.forEach(cat => {
        const items = results.categories[cat];
        const hasFail = items.some(i => i.t === 'fail');
        const hasWarn = items.some(i => i.t === 'warn');
        const headerClass = hasFail ? 'invalid' : (hasWarn ? 'warn' : 'valid');

        html += `<div class="result-group"><div class="result-header ${headerClass}">${cat}</div><div class="result-body">`;
        items.forEach(item => {
          html += `<div class="result-row"><div class="res-icon ${item.t === 'pass' ? 'pass' : (item.t === 'fail' ? 'fail' : 'warn')}">${item.t === 'pass' ? 'OK' : (item.t === 'fail' ? 'X' : '!')}</div><div class="res-text">${item.m}</div></div>`;
        });
        html += '</div></div>';
      });

      container.innerHTML = html;
    }

    // Init
    renderDokumen();
    renderSuperDokumen();
    updateNorkilUI();
    updateDeviasiUI();
    setSuperType('ro');
  </script>
</body>
</html>
